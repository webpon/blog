import{_ as s,c as n,o as a,a as l}from"./app.fc4ecf40.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"front-end/跨平台开发/安卓开发.md"}'),p={name:"front-end/跨平台开发/安卓开发.md"},o=l(`<h5 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-hidden="true">#</a></h5><blockquote><p>安卓（Android）是一种基于Linux内核的自由及开放源代码的操作系统。主要使用于移</p><p>动设备，如智能手机和平板电脑，由美国Google公司和开放手机联盟领导及开发。Android操作系统最初由Andy Rubin开发，主要支持手机。</p><p>Android 的官方编程语言包括 Java 和 Kotlin。</p></blockquote><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605224712204.png" alt="image-20220605224712204" style="zoom:50%;"><p><strong>Android</strong> <strong>主要版本发布时间</strong></p><blockquote><p>Android 几乎每年都要发布一个大版本，技术的更新迭代非常之快，列表展示了 Android 几个主要版本的发布时间。</p></blockquote><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605224814438.png" alt="image-20220605224814438" style="zoom:80%;"><h5 id="学习资源" tabindex="-1">学习资源 <a class="header-anchor" href="#学习资源" aria-hidden="true">#</a></h5><blockquote><p>1、哔哩哔哩视频教程：<a href="https://www.bilibili.com/video/BV19U4y1R7zV?p=1" target="_blank" rel="noreferrer">https://www.bilibili.com/video/BV19U4y1R7zV?p=1</a></p></blockquote><h5 id="安装-android-studio" tabindex="-1"><strong>安装</strong> <strong>Android Studio</strong> <a class="header-anchor" href="#安装-android-studio" aria-hidden="true">#</a></h5><p><strong>Android Studio</strong> <strong>发展历程</strong></p><blockquote><p>Android Studio 是 Android 应用的开发工具，由谷歌公司在 2013 年 5 月推出，Android Studio 基于 IntelliJ IDEA 演变而来，比 Eclipse 更加方便易用，运行速度也较快。</p></blockquote><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605224917318.png" alt="image-20220605224917318"></p><p>谷歌开发者的中文网站可直接下载Android Studio，详细的下载页面是 <a href="https://developer.android.google.cn/studio/index.html" target="_blank" rel="noreferrer">https://developer.android.google.cn/studio/index.html</a></p><p><strong><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605225038498.png" alt="image-20220605225038498" style="zoom:67%;"></strong></p><p><strong>安装过程界面</strong></p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605225150383.png" alt="image-20220605225150383" style="zoom:80%;"><p>全勾选 next</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605225220875.png" alt="image-20220605225220875" style="zoom:80%;"><p>选择Android Studio的安装目录</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605225240794.png" alt="image-20220605225240794" style="zoom:80%;"><p>Android Studio安装完成</p><p>启动</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605225455215.png" alt="image-20220605225455215" style="zoom:80%;"><p>但是有可能报这个错</p><p>**原因：**AS启动之后，会检查默认路径下的Android SDK 是否存在，如果没有的话，就会报上述错误</p><p><strong>解决方案</strong>:</p><p><code>其实只要你可以连接dl.google.com，这就根本不是一个问题</code>，因为在后续下载完成后，以后的启动就不会收到这个提示了。 可以查看这篇文章：<a href="https://www.jianshu.com/p/8fb367a51b9f" target="_blank" rel="noreferrer">《解决连不上dl.google.com的问题》</a>，测试你到dl.google.com的可连接性。 <a href="http://xn--dl-hf3c6r89ar2lumu855dllyapa197z.google.com" target="_blank" rel="noreferrer">假设你已经可以访问dl.google.com</a>，那么<code>点Cancel，Next</code>，直到出现一个下载界面，将提示选择需要下载的组件，建议全选，然后点下载。 <a href="http://xn--dl-sv2cs5euu5ixxk4ydoa517fkxq7xc.google.com" target="_blank" rel="noreferrer">下载需要保证能访问dl.google.com</a></p><p><strong>下载</strong> <strong>SDK</strong></p><blockquote><p>SDK 全称为 Software Development Kit，意即软件开发工具包，它可将 App 源码编译为可执行的 App 应用</p></blockquote><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605230113368.png" alt="image-20220605230113368" style="zoom:67%;"><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp.webp" alt="img" style="zoom:80%;"><p><strong>查看SDK是否安装完成</strong></p><p>如果在菜单页没有出现“SDK不可用”之类的提示，就说明SDK安装完成了。</p><p>可以打开Configure-&gt;Project Defaults-&gt;Project Structure ，查看SDK的地址，打开这个路径看看SDK是否安装完成了。</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-16544412451992.webp" alt="img" style="zoom:67%;"><p>汉化教程<a href="https://zhuanlan.zhihu.com/p/374517847%EF%BC%8C%E6%96%B9%E6%B3%95%E4%B8%80%E5%B7%B2%E5%A4%B1%E6%95%88%EF%BC%8C%E6%96%B9%E6%B3%95%E4%BA%8C%E6%AD%A3%E5%B8%B8%EF%BC%8C%E4%B8%8D%E8%BF%87%E8%A6%81%E6%A3%80%E6%9F%A5%E6%8F%92%E4%BB%B6%E7%9A%84%E6%97%A5%E5%BF%97%E4%B8%8Eas%E7%9A%84%E7%89%88%E6%9C%AC%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/374517847，方法一已失效，方法二正常，不过要检查插件的日志与as的版本是否匹配</a></p><h5 id="创建新项目" tabindex="-1">创建新项目 <a class="header-anchor" href="#创建新项目" aria-hidden="true">#</a></h5><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605230407246.png" alt="image-20220605230407246" style="zoom:67%;"><p>选择创建的模板，一般选Empty Activity</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605230546335.png" alt="image-20220605230546335" style="zoom:50%;"><p>下一步</p><p>输入项目名，选择项目路径，选择编程语言</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605230633884.png" alt="image-20220605230633884" style="zoom:50%;"><p>完成</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605230818409.png" alt="image-20220605230818409" style="zoom:50%;"><p>这时候可能需要下载很多东西，时间有点久，而且最好可以科学上网，不然有些包可能下不了</p><h5 id="创建内置模拟器" tabindex="-1">创建内置模拟器 <a class="header-anchor" href="#创建内置模拟器" aria-hidden="true">#</a></h5><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605231328421.png" alt="image-20220605231328421" style="zoom:50%;"><p>随便选</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605231408573.png" alt="image-20220605231408573" style="zoom:50%;"><p>下一步</p><p>选择操作系统，随便下载一个，一般下载一个比较新的就好了，下载好后选中它</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605231507953.png" alt="image-20220605231507953" style="zoom:50%;"><p>下一步</p><p>完成</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605231600187.png" alt="image-20220605231600187" style="zoom:50%;"><p>启动</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605231653775.png" alt="image-20220605231653775"></p><p>这里可以调整模式</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605231741884.png" alt="image-20220605231741884" style="zoom:67%;"><p><strong>模拟器运行项目</strong></p><p>1、选择项目，2、选择设备，3、运行至模拟器</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605232545347.png" alt="image-20220605232545347" style="zoom:50%;"><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605232704938.png" alt="image-20220605232704938" style="zoom:50%;"><h5 id="app-运行环境" tabindex="-1">App 运行环境 <a class="header-anchor" href="#app-运行环境" aria-hidden="true">#</a></h5><p>想要观察 App 的运行效果，有两种办法：</p><ul><li><p>在模拟器上运行 App 应用</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605234926795.png" alt="image-20220605234926795"></p></li><li><p>使用真实手机调试 App</p></li></ul><p>​ <img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605234940665.png" alt="image-20220605234940665" style="zoom:80%;"></p><h5 id="app-工程目录结构" tabindex="-1">App 工程目录结构 <a class="header-anchor" href="#app-工程目录结构" aria-hidden="true">#</a></h5><ul><li><p>App工程分为两个层次，第一个层次是项目，另一个层次是模块。</p></li><li><p>模块依附于项目，每个项目至少有一个模块，也能拥有多个模块。</p></li><li><p><code>一般所言的“编译运行App”，指的是运行某个模块</code>，而非运行某个项目，因为模块才对应实际的App</p></li><li><p>而每个页面就是一个Activity</p><blockquote><p>Activity 是一个应用程序组件，提供一个屏幕，用户可以用来交互为了完成某项 任务</p></blockquote><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605235129746.png" alt="image-20220605235129746"></p></li></ul><p><strong>Android 项目的主要目录文件：</strong></p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606001051063.png" alt="image-20220606001051063" style="zoom:67%;"><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwatermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80OTc3MDQ0Mw==,size_16,color_FFFFFF,t_70.png" alt="故屿" style="zoom:80%;"><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwatermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80OTc3MDQ0Mw==,size_16,color_FFFFFF,t_70-16544448664565.png" alt="故屿" style="zoom:80%;"><p><strong>app :</strong></p><p>通常 Android 的各个组成部分放在此目录中，其中 res 主要存放一些资源文件，如图片、layout、values 等资源。 <strong>build:</strong> 构建目录 <strong>libs:</strong> 依赖的包 <strong>src:</strong> androidTest: android 单元测试的目录 main: Java: 写 Java 代码的地方 MainActivity :是一个人机交互的程序，相当于人与计算机沟通的手段，在这里面写 Java 代码，从而达到想要实现的目的。 <strong>res:</strong> 资源文件 <strong>drawable:</strong> 图像资源，存放各种位图文件，(.png，.jpg，.9png，.gif等)除此之外可能是一些其他的 drawable 类型的 XML 文件。 <strong>layout:</strong> 布局资源 该目录下存放的就是我们的布局文件，另外在一些特定的机型上，我们做屏幕适配，比如 80*320 这样的手机，我们会另外创建一套布局如：layout-480x320 这样的文件夹！ activity_main.xml :是控制 Android 界面显示的文件，所有的配置控件都可以在这里进行设计。 <strong>mipmap:</strong> 图像资源 mipmap-hdpi：高分辨率，一般我们把图片丢这里 mipmap-mdpi：中等分辨率，很少，除非兼容的的手机很旧 mipmap-xhdpi：超高分辨率，手机屏幕材质越来越好，以后估计会慢慢往这里过渡 mipmap-xxhdpi：超超高分辨率，这个在高端机上有所体现 <strong>menu:</strong> 菜单资源（图中未给出） 在以前有物理菜单按钮，即 Menu 键的手机上，用的较多，现在用的并不多，菜单项相关的资源 XML 可在这里编写。 <strong>values:</strong> colors: 色彩资源 string: 字符串资源 demens: css配置文件，定义尺寸资源（图中未给出） styles: 定义样式资源 <strong>AndroidManifest.xml：</strong> 主配置文件，用于配置各个组件的访问权限</p><p><strong>Gradle：</strong></p><blockquote><p>Gradle 是一个项目自动化构建工具，帮我们做了依赖、打包、部署、发布、各种渠道的 差异管理等工作。</p></blockquote><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606001310172.png" alt="image-20220606001310172" style="zoom:67%;"><p><strong>编译配置文件</strong> <strong>build.gradle</strong>:</p><ul><li>项目级别的 build.gradle 指定了当前项目的总体编译规则。</li><li>模块级别的 build.gradle 对应于具体模块，每个模块都有自己的 build.gradle，它指定 了当前模块的详细编译规则。</li></ul><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606001601333.png" alt="image-20220606001601333" style="zoom:67%;"><p><strong>工程项目三个重要文件：</strong></p><blockquote><p>1.MainActivity.java 2.activity_main.xml (布局文件) 3.AndroidManifest.xml （安卓配置文件）</p></blockquote><ul><li>详情见：<a href="https://blog.csdn.net/weixin_49770443/article/details/117021620" target="_blank" rel="noreferrer">Hello World</a></li></ul><p>① MainActivity.java：</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwatermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80OTc3MDQ0Mw==,size_16,color_FFFFFF,t_70-16544450081117.png" alt="故屿" style="zoom:80%;"><blockquote><p>super.onCreate(savedInstanceState) 的作用： 调用其父类 Activity 的 onCreate 方法来实现对界面的图画绘制工作。在实现自己定义的 Activity 子类的 onCreate 方法时一定要记得调用该方法，以确保能够绘制界面。</p><p>setContentView(R.layout.main) 的作用： 加载一个界面，该方法中传入的参数是 “R.layout.main”，其含义为 R.java 类中静态内部类 layout 的静态常量 main 的值，而该值是一个指向 res 目录下的 layout 子目录下的 main.xml 文件的标识符，因此代表着显示 main.xml 所定义的画面。</p></blockquote><p>② activity_main.xml：</p><blockquote><p><code>类似与html与css文件的合体</code></p></blockquote><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwatermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80OTc3MDQ0Mw==,size_16,color_FFFFFF,t_70-16544450279809.png" alt="故屿" style="zoom:80%;"><p>③ AndroidManifest.xml：</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwatermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80OTc3MDQ0Mw==,size_16,color_FFFFFF,t_70-165444507780311.png" alt="故屿" style="zoom:80%;"><blockquote><p>Android Studio 安装配置步骤流程注意事项</p><p>参考链接：<a href="https://blog.csdn.net/weixin_43883917/article/details/108942788" target="_blank" rel="noreferrer">https://blog.csdn.net/weixin_43883917/article/details/108942788</a></p><p>AVD: Android Virtual Device，是 Android 的虚拟设备（模拟器），使用模拟器进行调试，不用实时连到物理设备上测试，方便调试。</p><p>SDK: Software Development Kit）软件开发工具包, 是一些软件工程师为特定的软件包、软件框架、硬件平台、操作系统等建立应用软件时的开发工具的集合。</p></blockquote><p><strong>Androin SDK 目录结构：</strong></p><ul><li>build-tools：各版本 SDK 编译工具；</li><li>extras：扩展开发包 如高版本的 API 在低版本中开发使用；</li><li>platforms-tools：各版本 SDK 通用工具；</li><li>sources：各版本 SDK 源码；</li><li>system-images：模拟器映像文件；</li><li>temp：临时夹，一般在 SDK 更新安装时用到。</li></ul><h5 id="界面显示与逻辑处理" tabindex="-1">界面显示与逻辑处理 <a class="header-anchor" href="#界面显示与逻辑处理" aria-hidden="true">#</a></h5><h6 id="简介-1" tabindex="-1">简介 <a class="header-anchor" href="#简介-1" aria-hidden="true">#</a></h6><blockquote><p>安卓应用利用 XML 标记描绘应用界面，使用Java或者Kotlin代码书写程序逻辑</p></blockquote><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606002254296.png" alt="image-20220606002254296" style="zoom:50%;"><p><strong>利用 XML 标记描绘应用界面</strong></p><p>把 App 的界面设计与代码逻辑分开的好处：</p><ul><li>使用 XML 文件描述 APP 界面，可以很方便地在 Android Studio 上预览界面效果。</li><li>一个界面布局可以被多处代码复用，反过来，一个 Java 代码也可能适配多个界面布局</li></ul><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606002343766.png" alt="image-20220606002343766" style="zoom:67%;"><h6 id="创建新的-app-页面" tabindex="-1">创建新的 App 页面 <a class="header-anchor" href="#创建新的-app-页面" aria-hidden="true">#</a></h6><p>完整的页面创建过程包括三个步骤：</p><ul><li>在 layout 目录下创建 XML 文件</li><li>创建与 XML 文件对应的 Java 代码</li><li>在 AndroidManifest.xml 中注册页面配置</li></ul><p>快速创建一个页面</p><ol><li>依次选择右键菜单New→Activity→Empty Activity，弹出图示的页面创建窗口。</li><li>输入各项信息后，单击窗口右下角的 Finish 按钮，即可完成新页面的创建动作。</li></ol><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606002456996.png" alt="image-20220606002456996" style="zoom:67%;"><h6 id="页面的跳转" tabindex="-1">页面的跳转 <a class="header-anchor" href="#页面的跳转" aria-hidden="true">#</a></h6><p><strong>新建一个页面</strong></p><p>然后在旧页面建立一个按钮</p><p>activity_main.xml:</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606091827780.png" alt="image-20220606091827780" style="zoom:50%;"><p>代码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_width=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_height=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        tools:context=&quot;.MainActivity&quot;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        &lt;Button</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:id=&quot;@+id/jump&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:layout_width=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:layout_height=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:text=&quot;跳转页面&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            tools:ignore=&quot;MissingConstraints&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>跳转逻辑：</p><p>MainActivity:</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606092052456.png" alt="image-20220606092052456" style="zoom:50%;"><p>代码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    package com.example.test;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    import androidx.appcompat.app.AppCompatActivity;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    import android.content.Intent;</span></span>
<span class="line"><span style="color:#A6ACCD;">    import android.os.Bundle;</span></span>
<span class="line"><span style="color:#A6ACCD;">    import android.util.Log;</span></span>
<span class="line"><span style="color:#A6ACCD;">    import android.view.View;</span></span>
<span class="line"><span style="color:#A6ACCD;">    import android.widget.Button;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    public class MainActivity extends AppCompatActivity {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        @Override</span></span>
<span class="line"><span style="color:#A6ACCD;">        protected void onCreate(Bundle savedInstanceState) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            super.onCreate(savedInstanceState);</span></span>
<span class="line"><span style="color:#A6ACCD;">            setContentView(R.layout.activity_main);</span></span>
<span class="line"><span style="color:#A6ACCD;">    //        获取按钮</span></span>
<span class="line"><span style="color:#A6ACCD;">            Button button = findViewById(R.id.jump);</span></span>
<span class="line"><span style="color:#A6ACCD;">            button.setOnClickListener(new View.OnClickListener(){</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                @Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                public void onClick(View v) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                    Intent intent = new Intent();</span></span>
<span class="line"><span style="color:#A6ACCD;">    //                第一个参数为当前页面，第二个参数为要跳转的页面</span></span>
<span class="line"><span style="color:#A6ACCD;">                    intent.setClass(MainActivity.this, MainActivity2.class);</span></span>
<span class="line"><span style="color:#A6ACCD;">    //                跳转页面</span></span>
<span class="line"><span style="color:#A6ACCD;">                    startActivity(intent);</span></span>
<span class="line"><span style="color:#A6ACCD;">                }</span></span>
<span class="line"><span style="color:#A6ACCD;">            });</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>返回上一个页面</p><p>activity_main.xml:</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606092209726.png" alt="image-20220606092209726" style="zoom:50%;"><p>代码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_width=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_height=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        tools:context=&quot;.MainActivity2&quot;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        &lt;Button</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:id=&quot;@+id/back&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:layout_width=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:layout_height=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:text=&quot;返回上一个页面&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            tools:ignore=&quot;MissingConstraints&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>返回逻辑</p><p>MainActivity2:</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606092255599.png" alt="image-20220606092255599" style="zoom:50%;"><p>代码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    package com.example.test;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    import androidx.appcompat.app.AppCompatActivity;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    import android.os.Bundle;</span></span>
<span class="line"><span style="color:#A6ACCD;">    import android.view.View;</span></span>
<span class="line"><span style="color:#A6ACCD;">    import android.widget.Button;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    public class MainActivity2 extends AppCompatActivity {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        @Override</span></span>
<span class="line"><span style="color:#A6ACCD;">        protected void onCreate(Bundle savedInstanceState) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            super.onCreate(savedInstanceState);</span></span>
<span class="line"><span style="color:#A6ACCD;">            setContentView(R.layout.activity_main2);</span></span>
<span class="line"><span style="color:#A6ACCD;">            // 获取按钮</span></span>
<span class="line"><span style="color:#A6ACCD;">            Button button =findViewById(R.id.back);</span></span>
<span class="line"><span style="color:#A6ACCD;">            button.setOnClickListener(new View.OnClickListener() {</span></span>
<span class="line"><span style="color:#A6ACCD;">                @Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                public void onClick(View v) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                    // 返回上一个页面</span></span>
<span class="line"><span style="color:#A6ACCD;">                    finish();</span></span>
<span class="line"><span style="color:#A6ACCD;">                }</span></span>
<span class="line"><span style="color:#A6ACCD;">            });</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h5 id="调试" tabindex="-1">调试 <a class="header-anchor" href="#调试" aria-hidden="true">#</a></h5><p>Android 采用 Log 工具打印日志，它将各类日志划分为五个等级：</p><ul><li>Log.e：表示错误信息，比如可能导致程序崩溃的异常。</li><li>Log.w：表示警告信息。</li><li>Log.i：表示一般消息。</li><li>Log.d：表示调试信息，可把程序运行时的变量值打印出来，方便跟踪调试。</li><li>Log.v：表示冗余信息</li></ul><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605233738365.png" alt="image-20220605233738365" style="zoom:50%;"><p><strong>过滤信息设置</strong></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605233903158.png" alt="image-20220605233903158"></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605234032762.png" alt="image-20220605234032762"></p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220605234057927.png" alt="image-20220605234057927" style="zoom:50%;"><h5 id="简单控件" tabindex="-1">简单控件 <a class="header-anchor" href="#简单控件" aria-hidden="true">#</a></h5><h6 id="textview" tabindex="-1">TextView <a class="header-anchor" href="#textview" aria-hidden="true">#</a></h6><blockquote><p>文字，是我们传达信息的一种常见方式。在安卓应用上显示文字，我们通常使用TextView。</p><p>之前我们已经知道如何获取到layout中的TextView，也知道setText()方法可以修改显示的文字。</p><p>结合我们实际的生活和学习经验，写字的时候，有哪些方面是可以由我们来控制的？ 文本内容；文字颜色；大小；背景等等。</p></blockquote><p><strong>最简单的TextView：</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;TextView</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:layout_width=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:layout_height=&quot;wrap_content&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>得益于as强大的提示功能，我们在layout中输入&lt;Te的时候，as可能就弹出了提示。</p><p>回车或者鼠标双击TextView即可。</p><p>这里关注两个基本属性layout_width和layout_height。分别表示TextView的宽度和高度设置。 实际上这两个属性是View的属性。TextView继承自View。</p><p>宽高属性是基础属性，是必须设置的。</p><p><strong>宽和高属性</strong> layout_width/layout_height 可以填入wrap_content，match_parent或者具体的数值。</p><ul><li><p>wrap_content：表示控件宽/高度可由内容来决定。对于TextView，文字越长，它的宽度越宽，直到父view（上层容器）允许的最大宽/高度。</p></li><li><p>match_parent：表示控件宽/高度达到父view允许的最大值。通俗说就是把空间撑满。</p></li></ul><p>我们也可以输入具体数值。比如80dp。 dp是安卓中的一种单位，通常用来规定控件的宽高，间隔距离等等。类似的，表示文字大小的单位，安卓里用sp。</p><p><strong>显示文字</strong> 显示文字，可能是 TextView 最主要的用法了。在 layout 中设置文字，使用 text 属性。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;TextView</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:id=&quot;@+id/tv1&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_width=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_height=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:text=&quot;新手教程&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;TextView</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:id=&quot;@+id/sample_tv&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_width=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_height=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:text=&quot;@string/app_name&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>这里涉及到一个代码风格的问题。上面分别给TextView设置了id。有的人喜欢驼峰风格的，例如sampleTv。</p><p>我们可以看到，设置text有多种方式。可以直接把内容写进去（hard code），也可以使用string资源。</p><p>直接写内容，as会给一个黄色的警告，建议用户换用@string资源的方式。鼠标移上去as就可以看到as的警告了。</p><p>若要使用@string资源，我们先看另一个xml文件，即strings.xml。它在<code>res/values</code>里面。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">	&lt;string name=&quot;app_name&quot;&gt;2021&lt;/string&gt; </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>资源命名风格也是小写字母加下划线。</p><p>res里面的很多资源，我们可以都可以用R...来找到。</p><p>前面我们提到，可以使用 TextView 的 setText 方法来设置文字内容，例如setText(&quot;123&quot;)。 也可以传入文字资源的名称（编号），类似setText(R.string.app_name)。</p><p>需要注意的是，R.string.app_name 本身是一个 int 数字，TextView 会根据这个编号去找对应的资源。 如果这样调用 setText(123)，大概率会报下面的这个错误。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">android.content.res.Resources$NotFoundException: String resource ID #0x0</span></span>
<span class="line"><span style="color:#A6ACCD;">    at android.content.res.Resources.getText(Resources.java:360)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>文字设置</strong> 一般来说，我们会设置TextView文字的颜色，背景等等。</p><ul><li><p>textColor 设置字体颜色</p></li><li><p>textSize 设置字体大小</p></li><li><p>textStyle 设置字体样式</p></li></ul><p>示例：</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/img0ba818ef9f1757dbe65b296f30e0fb3ea222127f.png@569w_168h_progressive.webp" alt="img"></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/img7af552226d229fe2be890371d5dadc9ec4370c64.png@701w_560h_progressive.webp" alt="img"></p><p><strong>textStyle 设置字体样式</strong> normal 没有特殊效果，默认值</p><ul><li><p>italic 斜体</p></li><li><p>bold 粗体</p></li><li><p>xml 中设置：</p></li></ul><p>示例1：设置斜体</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;TextView</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_width=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_height=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:text=&quot;Fisher&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:textColor=&quot;#000000&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:textStyle=&quot;italic&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>效果：</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/img9c33f5c95e5cfb998561b9abb2fa900ee07df913.png@146w_44h_progressive.webp" alt="img"></p><p>示例2：设置斜体并且加粗</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;TextView</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:layout_width=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:layout_height=&quot;wrap_content&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:text=&quot;bold|italic&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:textColor=&quot;#000000&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:textStyle=&quot;bold|italic&quot; /&gt; </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>效果：</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/img6cfe3354ccc6cf98de4d584acc8cbc6df4eb82f1.png@173w_47h_progressive.webp" alt="img"></p><p>代码中设置</p><p>使用 TextView 的 setTypeface 方法来设置字体效果。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">tv1.setTypeface(null, Typeface.NORMAL); // 普通</span></span>
<span class="line"><span style="color:#A6ACCD;">tv1.setTypeface(null, Typeface.BOLD); // 加粗</span></span>
<span class="line"><span style="color:#A6ACCD;">tv2.setTypeface(null, Typeface.ITALIC); // 斜体</span></span>
<span class="line"><span style="color:#A6ACCD;">tv3.setTypeface(null, Typeface.BOLD_ITALIC); // 加粗和斜体</span></span>
<span class="line"><span style="color:#A6ACCD;">setTypeface(@Nullable Typeface tf, @Typeface.Style int style)有2个参数。 第一个是字体，这里可以忽略。 第二个是效果，有正常，加粗，斜体，加粗和斜体这几种可选。</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>字体（字库）</strong> 默认情况下，TextView 的 typeface 属性支持 sans、serif和monospace 这三种字体。</p><p>系统默认 sans 作为文本显示的字体。但这三种字体只支持英文。如果显示中文，无论选择这三种字体中的哪一种，显示效果都是一样的。</p><p>l<strong>ayout中设置字体：</strong></p><p>使用 android:typeface 来设置字体。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    &lt;!-- sans字体 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;TextView</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:text=&quot;Hello,World&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:typeface=&quot;sans&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;!-- serifs字体 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;TextView</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:text=&quot;Hello,World&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:typeface=&quot;serif&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;!-- monospace字体 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;TextView</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:text=&quot;Hello,World&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:typeface=&quot;monospace&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>代码中使用字体：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    tv.setTypeface(Typeface.SERIF);</span></span>
<span class="line"><span style="color:#A6ACCD;">    tv.setTypeface(Typeface.SANS_SERIF);</span></span>
<span class="line"><span style="color:#A6ACCD;">    tv.setTypeface(Typeface.MONOSPACE);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>引入字体库</strong></p><p>需要引入ttf字体文件。把字体文件放在assets/font目录里。 代码中使用AssetManager来获取字体。</p><p>例如：在Activity中设置字体。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    TextView tv1 = findViewById(R.id.tv1);</span></span>
<span class="line"><span style="color:#A6ACCD;">    Typeface tf = Typeface.createFromAsset(getAssets(), &quot;fonts/otherFont.ttf&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">    tv1.setTypeface(tf); // 使用字体</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>间距设置</strong> margin 和 padding 其实是 View 的属性。这里我们拿 TextView 来看一下。</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/img0ac8ef1f286e49c8551a27ceb509b9e69b6e03be.png@942w_248h_progressive.webp" alt="img"></p><p>以后想显示一些文字的时候，我们首先会想起的是TextView。</p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220606093446613.png" alt="image-20220606093446613" style="zoom:50%;"><h5 id="高级控件" tabindex="-1">高级控件 <a class="header-anchor" href="#高级控件" aria-hidden="true">#</a></h5><h5 id="webview" tabindex="-1">WebView <a class="header-anchor" href="#webview" aria-hidden="true">#</a></h5><h6 id="webview简介" tabindex="-1">webview简介 <a class="header-anchor" href="#webview简介" aria-hidden="true">#</a></h6><blockquote><p>WebView是Android系统提供能显示网页的系统控件，它是一个特殊的View，同时它也是一个ViewGroup可以有很多其他子View。</p></blockquote><p><strong>webview作用</strong></p><ul><li>显示和渲染Web页面</li><li>加载网络上或本地assets中的html文件</li><li>与JavaScript交互调用</li></ul><h6 id="基础使用" tabindex="-1">基础使用 <a class="header-anchor" href="#基础使用" aria-hidden="true">#</a></h6><p>1、<strong>将WebView添加到应用</strong></p><p>需要在AndroidManifest中添加网络权限</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">manifest</span><span style="color:#89DDFF;"> ... &gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">uses-permission</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">android.permission.INTERNET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">manifest</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p><strong>android：usesCleartextTraffic</strong></p><p>指示应用程序是否打算使用明文网络流量，例如明文HTTP。目标<a href="https://so.csdn.net/so/search?q=API&amp;spm=1001.2101.3001.7020" target="_blank" rel="noreferrer">API</a>级别为27或更低的应用程序的默认值为“ true”。面向API级别28或更高级别的应用默认为“ false”。</p><p><em>当属性设置为“ false”时，平台组件（例如，HTTP和FTP堆栈，DownloadManager和MediaPlayer）将拒绝应用程序使用明文流量的请求。强烈建议第三方库也采用此设置。避免明文通信的主要原因是缺乏机密性，真实性和防篡改保护；网络攻击者可以窃听所传输的数据，并且还可以对其进行修改而不会被检测到。</em></p><p>2、需要在AndroidManifest加入</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"> &lt;application</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:usesCleartextTraffic=&quot;true&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        ...</span></span>
<span class="line"><span style="color:#A6ACCD;"> &lt;/application&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>AndroidManifest.xml总的代码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    package=&quot;com.example.webview_use&quot;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;!-- 开启网络权限 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;application</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:allowBackup=&quot;true&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:fullBackupContent=&quot;@xml/backup_rules&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:icon=&quot;@mipmap/ic_launcher&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:label=&quot;@string/app_name&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:supportsRtl=&quot;true&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:theme=&quot;@style/Theme.WebView_Use&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:usesCleartextTraffic=&quot;true&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        tools:targetApi=&quot;31&quot;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        &lt;activity</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:name=&quot;.MainActivity&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            android:exported=&quot;true&quot;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            &lt;intent-filter&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            &lt;/intent-filter&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        &lt;/activity&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;/application&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/manifest&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgimage-20220607093222172.png" alt="image-20220607093222172" style="zoom:50%;"><ul><li><code>方式一：将以下代码添加到Activity的布局XML文件中</code></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"> &lt;WebView</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:id=&quot;@+id/webview&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_width=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_height=&quot;match_parent&quot;/&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>在Activity中引用控件</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">WebView myWebView = (WebView) findViewById(R.id.webview);</span></span>
<span class="line"><span style="color:#A6ACCD;">myWebView.loadUrl(&quot;http://www.example.com&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>总的activity_main.xml代码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:layout_width=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    android:layout_height=&quot;match_parent&quot;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    &lt;WebView</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:id=&quot;@+id/web_view&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_width=&quot;match_parent&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        android:layout_height=&quot;match_parent&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/LinearLayout&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>总的MainActivity代码：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">package com.example.webview_use;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">import android.os.Bundle;</span></span>
<span class="line"><span style="color:#A6ACCD;">import android.webkit.WebView;</span></span>
<span class="line"><span style="color:#A6ACCD;">import android.webkit.WebViewClient;</span></span>
<span class="line"><span style="color:#A6ACCD;">import androidx.appcompat.app.AppCompatActivity;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">public class MainActivity extends AppCompatActivity {</span></span>
<span class="line"><span style="color:#A6ACCD;">        @Override</span></span>
<span class="line"><span style="color:#A6ACCD;">        protected void onCreate(Bundle savedInstanceState) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                super.onCreate(savedInstanceState);</span></span>
<span class="line"><span style="color:#A6ACCD;">                setContentView(R.layout.activity_main);</span></span>
<span class="line"><span style="color:#A6ACCD;">                WebView webView = (WebView) findViewById(R.id.web_view);</span></span>
<span class="line"><span style="color:#A6ACCD;">                webView.getSettings().setJavaScriptEnabled(true); //让webView支持js脚本</span></span>
<span class="line"><span style="color:#A6ACCD;">                webView.setWebViewClient(new WebViewClient()); //需要从一个网页跳转到另一个网页时，我们希望目标网页仍然在当前WebView中显示，而不是打开系统浏览器</span></span>
<span class="line"><span style="color:#A6ACCD;">                webView.loadUrl(&quot;http://www.baidu.com&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ul><li><code>方式二：直接在代码中添加</code></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">WebView myWebView = new WebView(activityContext);</span></span>
<span class="line"><span style="color:#A6ACCD;">setContentView(myWebView);</span></span>
<span class="line"><span style="color:#A6ACCD;">// or</span></span>
<span class="line"><span style="color:#A6ACCD;">FrameLayout flContainer = (FrameLayout) findViewById(R.id.fl_container);</span></span>
<span class="line"><span style="color:#A6ACCD;">WebView myWebView = new WebView(this);</span></span>
<span class="line"><span style="color:#A6ACCD;">flContainer.addView(myWebView );</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h6 id="webview的基础方法" tabindex="-1">WebView的基础方法 <a class="header-anchor" href="#webview的基础方法" aria-hidden="true">#</a></h6><ul><li>String getUrl()：获取当前页面的URL。</li><li>String getTitle()：获取当前页面的标题。</li><li>Bitmap getFavicon()：获取当前页面的favicon</li><li>int getProgress()：获取当前页面的加载进度</li><li>setInitialScale(int scaleInPercent)：设置初始缩放比例</li><li>reload()：重新reload当前的URL，即刷新。</li></ul><h6 id="webview加载url" tabindex="-1">WebView加载URL <a class="header-anchor" href="#webview加载url" aria-hidden="true">#</a></h6><ul><li>方式1. 加载一个网页</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">myWebView</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://www.baidu.com/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><ul><li>方式2：加载apk包中的html页面</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">myWebView</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file:///android_asset/test.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><ul><li>方式3：加载手机本地的html页面</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">myWebView</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content://com.android.htmlfileprovider/sdcard/test.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><ul><li>方式4： 加载 HTML 页面的一小段内容</li></ul><div class="language-dart"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 创建HTML文本</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 转化未编码HTML文本为字节码，并进行Base64编码</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 加载编码后的文本</span></span>
<span class="line"><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> unencodedHtml </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">&quot;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&#39;%23&#39; is the percent code for ‘#‘ &amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> encodedHtml </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Base64</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encodeToString</span><span style="color:#A6ACCD;">(unencodedHtml</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBytes</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">Base64</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">NO_PADDING</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadData</span><span style="color:#A6ACCD;">(encodedHtml</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;text/html&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;base64&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>其他方法：</p><ul><li>loadUrl(String url, Map&lt;String, String&gt; additionalHttpHeaders)：携带http headers加载URL指定的网页</li><li>postUrl(String url, byte[] postData)：使用POST请求加载指定的网页</li></ul><h6 id="webview的状态" tabindex="-1">WebView的状态 <a class="header-anchor" href="#webview的状态" aria-hidden="true">#</a></h6><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//激活WebView为活跃状态，能正常执行网页的响应</span></span>
<span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResume</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> ；</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//当页面被失去焦点被切换到后台不可见状态，需要执行onPause</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//通过onPause动作通知内核暂停所有的动作，比如DOM的解析、plugin的执行、JavaScript执行。</span></span>
<span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onPause</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">；</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//当应用程序(存在webview)被切换到后台时，这个方法不仅仅针对当前的webview而是全局的全应用程序的webview</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//它会暂停所有webview的layout，parsing，javascripttimer。降低CPU功耗。</span></span>
<span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pauseTimers</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//恢复pauseTimers状态</span></span>
<span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resumeTimers</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">；</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//销毁Webview</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//在关闭了Activity时，如果Webview的音乐或视频，还在播放。就必须销毁Webview</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//但是注意：webview调用destory时,webview仍绑定在Activity上</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//这是由于自定义webview构建时传入了该Activity的context对象</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//因此需要先从父容器中移除webview,然后再销毁webview:</span></span>
<span class="line"><span style="color:#A6ACCD;">rootLayout</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">removeView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">destroy</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><h6 id="前进-后退网页" tabindex="-1">前进 / 后退网页 <a class="header-anchor" href="#前进-后退网页" aria-hidden="true">#</a></h6><p><strong>基础用法</strong></p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//是否可以后退</span></span>
<span class="line"><span style="color:#A6ACCD;">Webview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">canGoBack</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//后退网页</span></span>
<span class="line"><span style="color:#A6ACCD;">Webview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">goBack</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//是否可以前进                     </span></span>
<span class="line"><span style="color:#A6ACCD;">Webview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">canGoForward</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//前进网页</span></span>
<span class="line"><span style="color:#A6ACCD;">Webview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">goForward</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//以当前的index为起始点前进或者后退到历史记录中指定的steps</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//如果steps为负数则为后退，正数则为前进</span></span>
<span class="line"><span style="color:#A6ACCD;">Webview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">goBackOrForward</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">intsteps</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><p><strong>常见用法：Back键控制网页后退</strong></p><ul><li>问题：在不做任何处理的情况下 ，浏览网页时点击系统的“Back”键,整个 Browser 会调用 finish()而结束自身</li><li>目标：点击“Back”键后，是网页回退而不是退出浏览器</li><li>解决方案：在当前Activity中处<code>理并消费掉</code>该 “Back”事件</li></ul><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onKeyDown</span><span style="color:#89DDFF;">(int</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">keyCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">KeyEvent</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">event</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">keyCode </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> KEYCODE_BACK</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> myWebView </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">canGoBack</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">        myWebView </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">goBack</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onKeyDown</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">keyCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> event</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h6 id="清除缓存数据" tabindex="-1">清除缓存数据 <a class="header-anchor" href="#清除缓存数据" aria-hidden="true">#</a></h6><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//清除网页访问留下的缓存</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//由于内核缓存是全局的因此这个方法不仅仅针对webview而是针对整个应用程序.</span></span>
<span class="line"><span style="color:#A6ACCD;">Webview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clearCache</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//清空当前页面之前的所有记录，也就是说当前的页面记录并不会被删除。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//比如从页面A打开页面B的同时调用该方法，此时当前页面是A,清空的是A的之前的记录,A的自身</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//记录还在。因此要在当前页面是B的时候调用该方法。</span></span>
<span class="line"><span style="color:#A6ACCD;">Webview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clearHistory</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">；</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//这个api仅仅清除自动完成填充的表单数据，并不会清除WebView存储到本地的数据</span></span>
<span class="line"><span style="color:#A6ACCD;">Webview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clearFormData</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">；</span></span>
<span class="line"></span></code></pre></div><h6 id="常用工具类" tabindex="-1">常用工具类 <a class="header-anchor" href="#常用工具类" aria-hidden="true">#</a></h6><p><strong>WebSettings</strong></p><p>设置webview属性需要依赖WebSettings类</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//声明WebSettings子类</span></span>
<span class="line"><span style="color:#A6ACCD;">WebSettings webSettings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> myWebView </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//如果访问的页面中要与Javascript交互，则webview必须设置支持Javascript</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 若加载的 html 里有JS 在执行动画等操作，会造成资源浪费（CPU、电量）</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 在 onStop 和 onResume 里分别把 setJavaScriptEnabled() 给设置成 false 和 true 即可</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//支持插件</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setPluginsEnabled</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//设置自适应屏幕，两者合用</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setUseWideViewPort</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//将图片调整到适合webview的大小 </span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setLoadWithOverviewMode</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 缩放至屏幕的大小</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//缩放操作</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setSupportZoom</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//支持缩放，默认为true。是下面那个的前提。</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setBuiltInZoomControls</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//设置内置的缩放控件。若为false，则该WebView不可缩放</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDisplayZoomControls</span><span style="color:#A6ACCD;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//隐藏原生的缩放控件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//其他细节操作</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCacheMode</span><span style="color:#A6ACCD;">(@CacheMode int mode)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//设置WebView的缓存模式。当我们加载页面或从上一个页面返回的时候，会按照设置的缓存模式去检查并使用（或不使用）缓存。缓存模式有四种：</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//LOAD_DEFAULT：默认的缓存使用模式。在进行页面前进或后退的操作时，如果缓存可用并未过期就优先加载缓存，否则从网络上加载数据。这样可以减少页面的网络请求次数。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//LOAD_CACHE_ELSE_NETWORK：只要缓存可用就加载缓存，哪怕它们已经过期失效。如果缓存不可用就从网络上加载数据。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//LOAD_NO_CACHE：不加载缓存，只从网络加载数据。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//LOAD_CACHE_ONLY：不从网络加载数据，只从缓存加载数据。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//通常我们可以根据网络情况将这几种模式结合使用，比如有网的时候使用LOAD_DEFAULT，离线时使用LOAD_CACHE_ONLY、LOAD_CACHE_ELSE_NETWORK，让用户不至于在离线时啥都看不到</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAllowFileAccess</span><span style="color:#A6ACCD;">(boolean allow)：是否可访问本地文件，默认值 </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAllowFileAccessFromFileURLs</span><span style="color:#A6ACCD;">(boolean flag)：是否允许通过file url加载的Javascript读取本地文件，默认值 </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAllowUniversalAccessFromFileURLs</span><span style="color:#A6ACCD;">(boolean flag)：是否允许通过file </span><span style="color:#82AAFF;">url加载的Javascript读取全部资源</span><span style="color:#A6ACCD;">(包括文件</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">https)，默认值 </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptCanOpenWindowsAutomatically</span><span style="color:#A6ACCD;">(boolean allow)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//是否可用Javascript(window.open)打开新窗口，默认值 false</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setLoadsImagesAutomatically</span><span style="color:#A6ACCD;">(boolean allow)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//是否自动加载图片</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setBlockNetworkImage</span><span style="color:#A6ACCD;">(boolean flag)：禁止加载网络图片</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDefaultTextEncodingName</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//设置编码格式</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDefaultFontSize</span><span style="color:#A6ACCD;">(int size)：设置默认字体大小</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDefaultFixedFontSize</span><span style="color:#A6ACCD;">(int size)：默认等宽字体尺寸</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setMinimumFontSize</span><span style="color:#A6ACCD;">(int size)：最小文字尺寸，默认值 </span><span style="color:#F78C6C;">8</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setMinimumLogicalFontSize</span><span style="color:#A6ACCD;">(int size)：最小文字逻辑尺寸，默认值 </span><span style="color:#F78C6C;">8</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setTextZoom</span><span style="color:#A6ACCD;">(int textZoom)：文字缩放百分比，默认值 </span><span style="color:#F78C6C;">100</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setStandardFontFamily</span><span style="color:#A6ACCD;">(String font)：标准字体，默认值 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sans-serif</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setSerifFontFamily</span><span style="color:#A6ACCD;">(String font)：衬线字体，默认值 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">serif</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setSansSerifFontFamily</span><span style="color:#A6ACCD;">(String font)：无衬线字体，默认值 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sans-serif</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setFixedFontFamily</span><span style="color:#A6ACCD;">(String font)：等宽字体，默认值 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">monospace</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCursiveFontFamily</span><span style="color:#A6ACCD;">(String font)：手写体，默认值 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cursive</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setFantasyFontFamily</span><span style="color:#A6ACCD;">(String font)：幻想体，默认值 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fantasy</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setMediaPlaybackRequiresUserGesture</span><span style="color:#A6ACCD;">(boolean require)：</span><span style="color:#82AAFF;">用户是否需要通过手势播放媒体</span><span style="color:#A6ACCD;">(不会自动播放)，默认值 </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setBlockNetworkLoads</span><span style="color:#A6ACCD;">(boolean flag)：禁止加载所有网络资源</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDomStorageEnabled</span><span style="color:#A6ACCD;">(boolean allow)：启用HTML5 DOM storage API，默认值 </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDatabaseEnabled</span><span style="color:#A6ACCD;">(boolean allow)：启用Web SQL Database API，这个设置会影响同一进程内的所有WebView，默认值 </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">，此API已不推荐使用</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAppCachePath</span><span style="color:#A6ACCD;">(String appCachePath)：设值缓存路径</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAppCacheEnabled</span><span style="color:#A6ACCD;">(boolean flag)：启用Application Caches API，必需设置有效的缓存路径才能生效，默认值 </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">，此API已废弃</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setGeolocationEnabled</span><span style="color:#A6ACCD;">(boolean flag)：启用定位</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setSaveFormData</span><span style="color:#A6ACCD;">(boolean save)：是否保存表单数据</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setNeedInitialFocus</span><span style="color:#A6ACCD;">(boolean flag)：是否当webview调用requestFocus时为页面的某个元素设置焦点，默认值 </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setUseWideViewPort</span><span style="color:#A6ACCD;">(boolean use)：是否支持viewport属性，默认值 </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">， 页面通过</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">meta name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/&gt;</span><span style="color:#A6ACCD;">自适应手机屏幕</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setLoadWithOverviewMode</span><span style="color:#A6ACCD;">(boolean overview)：是否使用overview mode加载页面，默认值 </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">，当页面宽度大于WebView宽度时，缩小使页面宽度等于WebView宽度</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setLayoutAlgorithm</span><span style="color:#A6ACCD;">(LayoutAlgorithm l)：布局算法，默认是LayoutAlgorithm#NARROW_COLUMNS</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setSupportMultipleWindows</span><span style="color:#A6ACCD;">(boolean support)：是否支持多窗口，默认值false</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAllowContentAccess</span><span style="color:#A6ACCD;">(boolean allow)：</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">是否可访问Content Provider的资源，默认值 </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setOffscreenPreRaster</span><span style="color:#A6ACCD;">(boolean enabled)：</span><span style="color:#82AAFF;">是否在离开屏幕时光栅化</span><span style="color:#A6ACCD;">(会增加内存消耗)，默认值 </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"></span></code></pre></div><p>常见用法：设置WebView缓存实现离线加载</p><div class="language-dart"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#FFCB6B;">NetStatusUtil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isConnected</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">getApplicationContext</span><span style="color:#A6ACCD;">())) {</span></span>
<span class="line"><span style="color:#A6ACCD;">    webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCacheMode</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">WebSettings</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">LOAD_DEFAULT</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//根据cache-control决定是否从网络上取数据。</span></span>
<span class="line"><span style="color:#A6ACCD;">} </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">    webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCacheMode</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">WebSettings</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">LOAD_CACHE_ELSE_NETWORK</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//没网，则从本地获取，即离线加载</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDomStorageEnabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 开启 DOM storage API 功能</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDatabaseEnabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">//开启 database storage API 功能</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAppCacheEnabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">//开启 Application Caches 功能</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> cacheDirPath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getFilesDir</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAbsolutePath</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">APP_CACAHE_DIRNAME</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAppCachePath</span><span style="color:#A6ACCD;">(cacheDirPath)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//设置  Application Caches 缓存目录</span></span>
<span class="line"></span></code></pre></div><p>注意： 每个 Application 只调用一次 WebSettings.setAppCachePath()，WebSettings.setAppCacheMaxSize()</p><p><strong>WebViewClient类</strong></p><p>这个类就像WebView的委托人一样，是帮助WebView处理各种通知和请求事件的 <strong>常见方法1：shouldOverrideUrlLoading()</strong> 打开网页时不调用系统浏览器， 而是在本WebView中显示；在网页上的所有加载都经过这个方法,这个函数我们可以做很多操作。返回true表示宿主app拦截并处理了该url，否则返回false由当前WebView处理,不处理POST请求</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">  myWebView </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebViewClient</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">shouldOverrideUrlLoading</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          view</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p>此方法在API24被废弃，API24添加如下方法：</p><ul><li>public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) 拦截页面加载，返回true表示宿主app拦截并处理了该url，否则返回false由当前WebView处理 不处理POST请求，可拦截处理子frame的非http请求</li></ul><p><strong>常见方法2：onPageStarted()</strong> 开始载入页面时调用</p><blockquote><p>我们可以设定一个loading的页面，告诉用户程序在等待网络响应。</p></blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">  myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebViewClient</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">onPageStarted</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Bitmap</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">favicon</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//设定加载开始的操作</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p><strong>常见方法3：onPageFinished()</strong> 在页面加载结束时调用</p><blockquote><p>我们可以关闭loading 条，切换程序动作。</p></blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"> myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebViewClient</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onPageFinished</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">         </span><span style="color:#676E95;font-style:italic;">//设定加载结束的操作</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p><strong>常见方法4：onLoadResource()</strong> 在加载页面资源时会调用，每一个资源（比如图片）的加载都会调用一次。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">  myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebViewClient</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onLoadResource</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">         </span><span style="color:#676E95;font-style:italic;">//设定加载资源的操作</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p><strong>常见方法5：onReceivedError()</strong> 加载页面的服务器出现错误时（如404）调用。</p><blockquote><p>App里面使用webview控件的时候遇到了诸如404这类的错误的时候，若也显示浏览器里面的那种错误提示页面就显得很丑陋了，那么这个时候我们的app就需要加载一个本地的错误提示页面，即webview如何加载一个本地的页面</p></blockquote><div class="language-dart"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//步骤1：写一个html文件（error_handle.html），用于出错时展示给用户看的提示页面</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//步骤2：将该html文件放置到代码根目录的assets文件夹下</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//步骤3：复写WebViewClient的onRecievedError方法</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//该方法传回了错误码，根据错误类型可以进行不同的错误分类处理</span></span>
<span class="line"><span style="color:#A6ACCD;">myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebViewClient</span><span style="color:#A6ACCD;">() {</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            public </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onReceivedError</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">WebView</span><span style="color:#A6ACCD;"> view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> errorCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> description</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> failingUrl) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#A6ACCD;"> (errorCode) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">HttpStatus</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">SC_NOT_FOUND</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                        view</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#A6ACCD;">(</span><span style="color:#C3E88D;">&quot;file:///android_assets/error_handle.html&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                }</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">        })</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>此方法废弃于API23，并添加如下方法：</p><ul><li>public void onReceivedError(WebView view, WebResourceRequest request, WebResourceError error) 加载资源时出错，通常意味着连接不到服务器。由于所有资源加载错误都会调用此方法，所以此方法应尽量逻辑简单</li></ul><p><strong>常见方法6：onReceivedSslError()</strong> 处理https请求,加载资源时发生了一个SSL错误，应用必需响应(继续请求或取消请求)， 处理决策可能被缓存用于后续的请求，默认行为是取消请求</p><blockquote><p>webView默认是不处理https请求的，页面显示空白，需要进行如下设置：</p></blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebViewClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onReceivedSslError</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">SslErrorHandler</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">handler</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">SslError</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">error</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                handler</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">proceed</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">//表示等待证书响应</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// handler.cancel();      //表示挂起连接，为默认方式</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// handler.handleMessage(null);    //可做其他处理</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 特别注意：5.1以上默认禁止了https和http混用，以下方式是开启</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VERSION</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SDK_INT </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> Build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VERSION_CODES</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LOLLIPOP</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">setMixedContentMode</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">WebSettings</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">MIXED_CONTENT_ALWAYS_ALLOW</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>其他方法</strong></p><ul><li>public WebResourceResponse shouldInterceptRequest(WebView view, String url) 调用于非UI线程拦截资源请求并返回响应数据，返回null时WebView将继续加载资源。注意：API21以下的AJAX请求会走onLoadResource，无法通过此方法拦截，此方法废弃于API21</li><li>public WebResourceResponse shouldInterceptRequest(WebView view, WebResourceRequest request) 此方法添加于API21，调用于非UI线程，拦截资源请求并返回数据，返回null时WebView将继续加载资源</li><li>public void onReceivedHttpError(WebView view, WebResourceRequest request, WebResourceResponse errorResponse) 此方法添加于API23， 在加载资源(iframe,image,js,css,ajax...)时收到了 HTTP 错误(状态码&gt;=400)</li><li>public void onFormResubmission(WebView view, Message dontResend, Message resend) 是否重新提交表单，默认不重发</li><li>public void onReceivedClientCertRequest(WebView view, ClientCertRequest request) 此方法添加于API21，在UI线程被调用， 处理SSL客户端证书请求，必要的话可显示一个UI来提供KEY。 有三种响应方式：proceed()/cancel()/ignore()，默认行为是取消请求，如果调用proceed()或cancel()，Webview 将在内存中保存响应结果且对相同的&quot;host:port&quot;不会再次调用 onReceivedClientCertRequest 多数情况下，可通过KeyChain.choosePrivateKeyAlias启动一个Activity供用户选择合适的私钥</li><li>public void onReceivedHttpAuthRequest(WebView view, HttpAuthHandler handler, String host, String realm) 处理HTTP认证请求，默认行为是取消请求</li><li>public void onReceivedLoginRequest(WebView view, String realm, String account, String args) 通知应用有个已授权账号自动登陆了</li><li>public boolean shouldOverrideKeyEvent(WebView view, KeyEvent event) 给应用一个机会处理按键事件，如果返回true，WebView不处理该事件，否则WebView会一直处理，默认返回false</li><li>public void onScaleChanged(WebView view, float oldScale, float newScale) 通知应用页面缩放系数变化</li></ul><p><strong>一些关键方法调用流程</strong></p><ul><li>loadUrl()无重定向时</li></ul><blockquote><p>onPageStarted()-&gt;onPageFinished()</p></blockquote><ul><li>loadUrl()网页A重定向到B时</li></ul><blockquote><p>onPageStarted()-&gt;shouldOverrideUrlLoading()-&gt;onPageStarted()-&gt;onPageFinished()-&gt;onPageFinished()</p></blockquote><ul><li>在已加载的页面中点击链接，加载页面A（无重定向)</li></ul><blockquote><p>shouldOverrideUrlLoading()-&gt;onPageStarted()-&gt;onPageFinished()</p></blockquote><ul><li>在已加载的页面中点击链接，加载页面A（页面A重定向至页面B）</li></ul><blockquote><p>shouldOverrideUrlLoading()-&gt;onPageStarted()-&gt;shouldOverrideUrlLoading()-&gt;onPageStarted()-&gt;onPageFinished()-&gt;onPageFinished()</p></blockquote><ul><li>执行goBack/goForward/reload方法</li></ul><blockquote><p>onPageStarted()-&gt;onPageFinished()</p></blockquote><ul><li>发生资源加载</li></ul><blockquote><p>shouldInterceptRequest-&gt;onLoadResource</p></blockquote><p>WebChromeClient类</p><p>辅助 WebView 处理 Javascript 的对话框,网站图标,网站标题等等。 <strong>常见方法1： onProgressChanged()</strong> 获得网页的加载进度并显示</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebChromeClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebChromeClient</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onProgressChanged</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">newProgress</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">newProgress </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">              </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> progress </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> newProgress </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">              progress</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">progress</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>常见方法2： onReceivedTitle()</strong> 获取Web页中的标题</p><blockquote><p>每个网页的页面都有一个标题，比如<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.baidu.com" target="_blank" rel="noreferrer">www.baidu.com</a>这个页面的标题即“百度一下，你就知道”，那么如何知道当前webview正在加载的页面的title并进行设置呢？</p></blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebChromeClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebChromeClient</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onReceivedTitle</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">title</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">       titleview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">；</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>常见方法3： onJsAlert()</strong> 支持javascript的警告框</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebChromeClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebChromeClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onJsAlert</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">message</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">JsResult</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> AlertDialog</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Builder</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MainActivity</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">this</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setTitle</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">JsAlert</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setMessage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">message</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setPositiveButton</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">OK</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> DialogInterface</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">OnClickListener</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onClick</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">DialogInterface</span><span style="color:#A6ACCD;"> dialog</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> which</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                                result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">confirm</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCancelable</span><span style="color:#89DDFF;">(false)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p><strong>常见方法4： onJsConfirm()</strong> 支持javascript的确认框</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebChromeClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebChromeClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onJsConfirm</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">message</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">JsResult</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> AlertDialog</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Builder</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MainActivity</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">this</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setTitle</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">JsConfirm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setMessage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">message</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setPositiveButton</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">OK</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> DialogInterface</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">OnClickListener</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onClick</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">DialogInterface</span><span style="color:#A6ACCD;"> dialog</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> which</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                                result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">confirm</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setNegativeButton</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cancel</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> DialogInterface</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">OnClickListener</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onClick</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">DialogInterface</span><span style="color:#A6ACCD;"> dialog</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> which</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                                result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cancel</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCancelable</span><span style="color:#89DDFF;">(false)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// 返回布尔值：判断点击时确认还是取消</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// true表示点击了确认；false表示点击了取消；</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p><strong>常见方法5： onJsPrompt()</strong> 支持javascript输入框</p><blockquote><p>点击确认返回输入框中的值，点击取消返回 null。</p></blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">myWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebChromeClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebChromeClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onJsPrompt</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">message</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">defaultValue</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">JsPromptResult</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">EditText</span><span style="color:#A6ACCD;"> et </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">EditText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MainActivity</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">this</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                et</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">defaultValue</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> AlertDialog</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Builder</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MainActivity</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">this</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setTitle</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">message</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">et</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setPositiveButton</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">OK</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> DialogInterface</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">OnClickListener</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onClick</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">DialogInterface</span><span style="color:#A6ACCD;"> dialog</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> which</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                                result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">confirm</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">et</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getText</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">toString</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setNegativeButton</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Cancel</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> DialogInterface</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">OnClickListener</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onClick</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">DialogInterface</span><span style="color:#A6ACCD;"> dialog</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> which</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                                result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cancel</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCancelable</span><span style="color:#89DDFF;">(false)</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">show</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p><strong>其他方法</strong></p><ul><li><p>public void getVisitedHistory(ValueCallback&lt;String[]&gt; callback) 获得所有访问历史项目的列表，用于链接着色。</p></li><li><p>public Bitmap getDefaultVideoPoster()</p><p><video></video> 控件在未播放时，会展示为一张海报图，HTML中可通过它的&#39;poster&#39;属性来指定。</p><p>如果未指定&#39;poster&#39;属性，则通过此方法提供一个默认的海报图。</p></li><li><p>public View getVideoLoadingProgressView() 当全屏的视频正在缓冲时，此方法返回一个占位视图(比如旋转的菊花)。</p></li><li><p>public void onShowCustomView(View view, CustomViewCallback callback) 通知应用当前页进入了全屏模式，此时应用必须显示一个包含网页内容的自定义View</p></li><li><p>public void onHideCustomView() 通知应用当前页退出了全屏模式，此时应用必须隐藏之前显示的自定义View -public boolean onJsBeforeUnload(WebView view, String url, String message, JsResult result) 显示一个对话框让用户选择是否离开当前页面</p></li><li><p>public void onGeolocationPermissionsShowPrompt(String origin, GeolocationPermissions.Callback callback) 指定源网页内容在没有设置权限状态下尝试使用地理位置API。 从API24开始，此方法只为安全的源(https)调用，非安全的源会被自动拒绝</p></li><li><p>public void onGeolocationPermissionsHidePrompt() 当前一个调用 onGeolocationPermissionsShowPrompt() 取消时，隐藏相关的UI。</p></li><li><p>public boolean onCreateWindow(WebView view, boolean isDialog, boolean isUserGesture, Message resultMsg) 通知应用打开新窗口</p></li><li><p>public void onCloseWindow(WebView window) 通知应用关闭窗口</p></li><li><p>public void onRequestFocus(WebView view) 请求获取取焦点</p></li><li><p>public void onPermissionRequest(PermissionRequest request) 通知应用网页内容申请访问指定资源的权限(该权限未被授权或拒绝)</p></li><li><p>public void onPermissionRequestCanceled(PermissionRequest request) 通知应用权限的申请被取消，隐藏相关的UI。</p></li><li><p>public boolean onShowFileChooser(WebView webView, ValueCallback&lt;Uri[]&gt; filePathCallback, FileChooserParams fileChooserParams) 为&#39;<input type="file">&#39;显示文件选择器，返回false使用默认处理</p></li><li><p>public boolean onConsoleMessage(ConsoleMessage consoleMessage) 接收JavaScript控制台消息</p></li></ul><p>另：页面加载方法调用流程</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    shouldOverrideUrlLoading()</span></span>
<span class="line"><span style="color:#A6ACCD;">     onProgressChanged[10]</span></span>
<span class="line"><span style="color:#A6ACCD;">     shouldInterceptRequest()</span></span>
<span class="line"><span style="color:#A6ACCD;">     onProgressChanged[...]</span></span>
<span class="line"><span style="color:#A6ACCD;">     onPageStarted()</span></span>
<span class="line"><span style="color:#A6ACCD;">     onProgressChanged[...]</span></span>
<span class="line"><span style="color:#A6ACCD;">     onLoadResource()</span></span>
<span class="line"><span style="color:#A6ACCD;">     onProgressChanged[...]</span></span>
<span class="line"><span style="color:#A6ACCD;">     onReceivedTitle()/onPageCommitVisible()</span></span>
<span class="line"><span style="color:#A6ACCD;">     onProgressChanged[100]</span></span>
<span class="line"><span style="color:#A6ACCD;">     onPageFinished()</span></span>
<span class="line"><span style="color:#A6ACCD;">     onReceivedIcon()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><strong>总结</strong></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/img944365-6e249d5a3cc7d343.png" alt="img"></p><h6 id="如何避免webview内存泄露" tabindex="-1">如何避免WebView内存泄露？ <a class="header-anchor" href="#如何避免webview内存泄露" aria-hidden="true">#</a></h6><ul><li>不在xml中定义 Webview ，而是在需要的时候在Activity中创建，并且Context使用 getApplicationgContext()</li></ul><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">LinearLayout</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">LayoutParams</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">params</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">LinearLayout</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">LayoutParams</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ViewGroup</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LayoutParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">MATCH_PARENT</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ViewGroup</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LayoutParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">MATCH_PARENT</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">mWebView </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebView</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">getApplicationContext</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setLayoutParams</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">mLayout</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><ul><li>在 Activity 销毁（ WebView ）的时候，先让 WebView 加载null内容，然后移除 WebView，再销毁 WebView，最后置空。</li></ul><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onDestroy</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mWebView </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadDataWithBaseURL</span><span style="color:#89DDFF;">(null,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text/html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null);</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clearHistory</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">ViewGroup</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getParent</span><span style="color:#89DDFF;">()).</span><span style="color:#82AAFF;">removeView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">destroy</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebView </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onDestroy</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>如何避免WebView内存泄露？</strong></p><p>实例</p><ul><li>目标：实现显示“<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.baidu.com" target="_blank" rel="noreferrer">www.baidu.com</a>”、获取其标题、提示加载开始 &amp; 结束和获取加载进度</li><li>具体实现： <strong>步骤1：添加访问网络权限</strong></li></ul><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">uses-permission</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">android.permission.INTERNET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"></span></code></pre></div><p><strong>步骤2：主布局</strong><em>activity_main.xml</em></p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;?</span><span style="color:#F07178;">xml</span><span style="color:#C792EA;"> version</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;"> encoding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">?&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">RelativeLayout</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">xmlns</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://schemas.android.com/apk/res/android</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">xmlns</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">tools</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://schemas.android.com/tools</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">match_parent</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">match_parent</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">paddingBottom</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@dimen/activity_vertical_margin</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">paddingLeft</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@dimen/activity_horizontal_margin</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">paddingRight</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@dimen/activity_horizontal_margin</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">paddingTop</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@dimen/activity_vertical_margin</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">tools</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">context</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">com.example.carson_ho.webview_demo.MainActivity</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">&lt;!-- 获取网站的标题--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">TextView</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/title</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wrap_content</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wrap_content</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">text</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--开始加载提示--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">TextView</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/text_beginLoading</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_below</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/title</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wrap_content</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wrap_content</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">text</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--获取加载进度--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">TextView</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_below</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/text_beginLoading</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/text_Loading</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wrap_content</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wrap_content</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">text</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--结束加载提示--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">TextView</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_below</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/text_Loading</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/text_endLoading</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wrap_content</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wrap_content</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">text</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--显示网页区域--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">WebView</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/webView1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_below</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@+id/text_endLoading</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_width</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fill_parent</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_height</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fill_parent</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">layout_marginTop</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10dp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">RelativeLayout</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p><strong>步骤3：根据需要实现的功能从而使用相应的子类及其方法（注释很清楚了）</strong><em>MainActivity.java</em></p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MainActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">AppCompatActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> mWebview</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">WebSettings</span><span style="color:#A6ACCD;"> mWebSettings</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">TextView</span><span style="color:#A6ACCD;"> beginLoading</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> endLoading</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> loading</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mtitle</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Bundle</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">savedInstanceState</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">savedInstanceState</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">setContentView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">layout</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activity_main</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        mWebview </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">webView1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        beginLoading </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">TextView</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text_beginLoading</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        endLoading </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">TextView</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text_endLoading</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        loading </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">TextView</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">text_Loading</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        mtitle </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">TextView</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        mWebSettings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://www.baidu.com/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//设置不用系统浏览器打开,直接显示在当前Webview</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebViewClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">shouldOverrideUrlLoading</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                view</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//设置WebChromeClient类</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebChromeClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebChromeClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//获取网站标题</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onReceivedTitle</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">title</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">标题在这里</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                mtitle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//获取加载进度</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onProgressChanged</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">newProgress</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">newProgress </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> progress </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> newProgress </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                    loading</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">progress</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">newProgress </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> progress </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> newProgress </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                    loading</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">progress</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//设置WebViewClient类</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebViewClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//设置加载前的函数</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onPageStarted</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Bitmap</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">favicon</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">开始加载了</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                beginLoading</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">开始加载了</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//设置结束加载函数</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onPageFinished</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                endLoading</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setText</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">结束加载了</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//点击返回上一页面而不是退出浏览器</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onKeyDown</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">keyCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">KeyEvent</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">event</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">keyCode </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> KeyEvent</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">KEYCODE_BACK </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">canGoBack</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">goBack</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onKeyDown</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">keyCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> event</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//销毁Webview</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onDestroy</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mWebview </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadDataWithBaseURL</span><span style="color:#89DDFF;">(null,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text/html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null);</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clearHistory</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">ViewGroup</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getParent</span><span style="color:#89DDFF;">()).</span><span style="color:#82AAFF;">removeView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mWebview</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebview</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">destroy</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            mWebview </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onDestroy</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h6 id="cookiemanager" tabindex="-1">CookieManager <a class="header-anchor" href="#cookiemanager" aria-hidden="true">#</a></h6><p>帮助webview管理Cookie的类 <strong>常用方法：</strong></p><ul><li>CookieManager getInstance()：获得一个CookieManager实例</li><li>String getCookie(String url)：根据url获取Cookie，以字符串形式返回Cookie</li><li>void setCookie(String url, String value)：为url设置Cookie</li><li>void setCookie(String url, String value, ValueCallback<code>&lt;Boolean&gt;</code> callback)： callback的onReceiveValue方法获取的参数如果是true，代表本次设置成功，否则代表设置失败。如果并不关心执行结果，为callback参数传入null即可</li><li>void setAcceptCookie(boolean accept)：设置WebView是否允许使用Cookie，这个方法针对的是当前应用的所有WebView。</li><li>void setAcceptThirdPartyCookies(WebView webview, boolean accept)：设置WebView是否允许设置第三方Cookie，Android 5.0（API 21）以下默认为true，Android 5.0及以上默认为false</li><li>void removeSessionCookies(ValueCallback<code>&lt;Boolean&gt;</code> callback)：移除所有Session Cookies（异步执行），在执行完移除操作后，会回调onReceiveValue方法</li><li>void removeAllCookies(ValueCallback<code>&lt;Boolean&gt;</code> callback)：移除所有Cookies（异步执行），在执行完移除操作后，会回调onReceiveValue方法</li><li>boolean hasCookies()：判断是否存在Cookies</li></ul><p><strong>关于Cookie</strong> Hybrid App（混合式应用）的开发过程中少不了与WebView的交互，在涉及到账户体系的产品中，包含了一种登录状态的传递，而Cookie作为网页身份信息的载体，便需要将其传递到Web里面，从而避免二次身份认证，这时就涉及到WebView加载网页时的Cookie操作了。通常我们在登录时获取到用户的Cookie信息，然后将其保存到sdcard的WebView缓存文件当中，然后再加载网页时，WebView会自动将当前url的本地Cookie信息放在http请求的request中，传递给服务器。</p><blockquote><p>Cookie 默认保存位置: data/data/package_name/app_WebView/Cookies.db</p></blockquote><p><strong>保存Cookie</strong> 我们通常使用安卓提供的CookieManager类中的setCookie(String url, String value)或void setCookie(String url, String value, ValueCallback<code>&lt;Boolean&gt;</code> callback)方法来对url的Cookie进行设置。方法作用见上文。另外API文档注释：</p><blockquote><p>Sets a cookie for the given URL. Any existing cookie with the same host, path and name will be replaced with the new cookie. The cookie being set will be ignored if it is expired.</p></blockquote><p>可见具有相同host和path的cookie会自动覆盖掉旧的cookie信息，当存储的cookie信息过期时会被自动忽略。 <strong>关于host(Domain)和path</strong></p><ul><li>host(Domain)表示cookie所在的域，默认为请求地址,如网址为<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.test.com%2Ftest%2Ftest.aspx" target="_blank" rel="noreferrer">www.test.com/test/test.aspx</a>，那么domain默认为<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.test.com" target="_blank" rel="noreferrer">www.test.com</a>。而跨域访问，如域A为<a href="https://links.jianshu.com/go?to=http%3A%2F%2Ft1.test.com" target="_blank" rel="noreferrer">t1.test.com</a>，域B为<a href="https://links.jianshu.com/go?to=http%3A%2F%2Ft2.test.com" target="_blank" rel="noreferrer">t2.test.com</a>，那么在域A生产一个令域A和域B都能访问的cookie就要将该cookie的domain设置为<a href="https://links.jianshu.com/go?to=http%3A%2F%2F.test.com" target="_blank" rel="noreferrer">.test.com</a>；如果要在域A生产一个令域A不能访问而域B能访问的cookie就要将该cookie的domain设置为<a href="https://links.jianshu.com/go?to=http%3A%2F%2Ft2.test.com" target="_blank" rel="noreferrer">t2.test.com</a>。</li><li>path表示cookie所在的目录，asp.net默认为/，就是根目录。在同一个服务器上有目录如下：/test/,/test/cd/,/test/dd/，现设一个cookie1的path为/test/，cookie2的path为/test/cd/，那么test下的所有页面都可以访问到cookie1，而/test/和/test/dd/的子页面不能访问cookie2。这是因为cookie只能让其path路径下的页面访问。因此一般如果访问一级域名，只需要将path设置为根目录就可以。</li></ul><p><strong>针对一级域名同步Cookie</strong></p><ol><li>针对项目使用的一级域名进行设置 Cookie</li><li>选择合适的时机进行刷新</li></ol><div class="language-dart"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * 同步cookie</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * @param context 上下文</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * @param url 一级域名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * @param cookies 需要添加的Cookie值,以键值对的方式:key=value</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#A6ACCD;">    public </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">synCookies</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">Context</span><span style="color:#A6ACCD;"> context</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">List</span><span style="color:#A6ACCD;">&lt;</span><span style="color:#FFCB6B;">HttpCookie</span><span style="color:#A6ACCD;">&gt; cookies) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#FFCB6B;">Build</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">VERSION</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">SDK_INT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Build</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">VERSION_CODES</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">LOLLIPOP</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">CookieSyncManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createInstance</span><span style="color:#A6ACCD;">(context)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">CookieManager</span><span style="color:#A6ACCD;"> cookieManager </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CookieManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getInstance</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        cookieManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAcceptCookie</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// 允许接受 Cookie</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#FFCB6B;">Build</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">VERSION</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">SDK_INT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Build</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">VERSION_CODES</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">LOLLIPOP</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            cookieManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">removeSessionCookie</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// 移除</span></span>
<span class="line"><span style="color:#A6ACCD;">        } </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">            cookieManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">removeSessionCookies</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// 移除</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> (</span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> cookies</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">size</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">++</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">HttpCookie</span><span style="color:#A6ACCD;"> cookie </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cookies</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(i)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> value </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cookie</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getName</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;=&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> cookie</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getValue</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            cookieManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCookie</span><span style="color:#A6ACCD;">(url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> value)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        cookieManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCookie</span><span style="color:#A6ACCD;">(url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;Domain=&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">url)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        cookieManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCookie</span><span style="color:#A6ACCD;">(url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">&quot;Path=/&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#FFCB6B;">Build</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">VERSION</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">SDK_INT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Build</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">VERSION_CODES</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">LOLLIPOP</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">CookieSyncManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getInstance</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#89DDFF;font-style:italic;">sync</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        } </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">            cookieManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">flush</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"></span></code></pre></div><p>这里简单说明：</p><ul><li>参数中的 URL 在使用过程中基本是域名。例如 <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.baidu.com%2F" target="_blank" rel="noreferrer">https://www.baidu.com/</a> 就可以使 <a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.baidu.com" target="_blank" rel="noreferrer">www.baidu.com</a></li><li>注意使用 for 循环 进行 setCookie(String url, String value) 调用。使用分号手动拼接的 value 值会导致 Cookie 不能完整设置或者无效</li><li>注意 value 的值是使用 key=value 的完整形式。文档提示：</li></ul><blockquote><p>the cookie as a string, using the format of the &#39;Set-Cookie&#39; HTTP response header</p></blockquote><ul><li>CookieSyncManager 是个过时的类，Api21 中 WebView 可以自动同步,使用时可以添加版本判断</li><li>CookieSyncManager.getInstance().sync(); 方法的替代方法是 cookieManager.flush()</li><li>Cookie 同步方法要在 WebView 的 setting 设置完之后,WebView的loadUrl(url)之前调用，否则无效。</li></ul><p><strong>Cookie的过期机制</strong> 可以设置Cookie的生效时间字段名为： expires 或 max-age。</p><div class="language-swift"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">expires：过期的时间点</span></span>
<span class="line"><span style="color:#A6ACCD;">max</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">age：生效的持续时间，单位为秒</span><span style="color:#89DDFF;">。</span></span>
<span class="line"></span></code></pre></div><ol><li>若将Cookie的 max-age 设置为负数，或者 expires 字段设置为过期时间点，数据库更新后这条Cookie将从数据库中被删除。</li><li>如果将Cookie的 max-age 和 expires 字段设置为正常的过期日期，则到期后再数据库更新时会删除该条数据。</li></ol><h6 id="特殊场景介绍" tabindex="-1">特殊场景介绍 <a class="header-anchor" href="#特殊场景介绍" aria-hidden="true">#</a></h6><p><strong>1、视口(viewport)</strong> 视口是一个为网页提供绘图区域的矩形。 你可以指定数个视口属性，比如尺寸和初始缩放系数(initial scale)。其中最重要的是视口宽度，它定义了网页水平方向的可用像素总数(可用的CSS像素数)。 多数 Android 上的网页浏览器(包括 Chrome)设置默认视口为一个大尺寸(被称为&quot;wide viewport mode&quot;，宽约 980px)。 也有许多浏览器默认会尽可能缩小以显示完整的视口宽度(被称为&quot;overview mode&quot;)</p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 是否支持viewport属性，默认值 false</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 页面通过\`&lt;meta name=&quot;viewport&quot; ... /&gt;\`自适应手机屏幕</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 当值为true且viewport标签不存在或未指定宽度时使用 wide viewport mode</span></span>
<span class="line"><span style="color:#A6ACCD;">settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setUseWideViewPort</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 是否使用overview mode加载页面，默认值 false</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 当页面宽度大于WebView宽度时，缩小使页面宽度等于WebView宽度</span></span>
<span class="line"><span style="color:#A6ACCD;">settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setLoadWithOverviewMode</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"></span></code></pre></div><p>viewport 语法</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">          height = [pixel_value | </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">device-height</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">] ,</span></span>
<span class="line"><span style="color:#C3E88D;">          width = [pixel_value | </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">device-width</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">] ,</span></span>
<span class="line"><span style="color:#C3E88D;">          initial-scale = float_value ,</span></span>
<span class="line"><span style="color:#C3E88D;">          minimum-scale = float_value ,</span></span>
<span class="line"><span style="color:#C3E88D;">          maximum-scale = float_value ,</span></span>
<span class="line"><span style="color:#C3E88D;">          user-scalable = [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">yes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> | </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">no</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">]</span></span>
<span class="line"><span style="color:#C3E88D;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span></code></pre></div><p>通过WebView设置初始缩放(initial-scale)</p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 设置初始缩放百分比</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 0表示依赖于setUseWideViewPort和setLoadWithOverviewMode</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 100表示不缩放</span></span>
<span class="line"><span style="color:#A6ACCD;">web</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setInitialScale</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p><strong>2、长按保存图片或者拨打电话</strong> 一般浏览器都有长按保存图片或者拨打电话的功能，实现这个功能和WebView.HitTestResult这个类有关，这个类会将你触摸网页的地方的类型和其他信息反馈给你。 WebView.HitTestResult的常用方法：</p><ul><li>HitTestResult.getExtra()：获取额外的信息。</li><li>HitTestResult.getType()：获取所选中目标的类型，可以是如下类型。</li></ul><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UNKNOWN_TYPE</span><span style="color:#676E95;font-style:italic;"> //未知类型  </span></span>
<span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PHONE_TYPE</span><span style="color:#676E95;font-style:italic;"> //电话类型</span></span>
<span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">EMAIL_TYPE</span><span style="color:#676E95;font-style:italic;"> //电子邮件类型</span></span>
<span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GEO_TYPE</span><span style="color:#676E95;font-style:italic;"> //地图类型</span></span>
<span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SRC_ANCHOR_TYPE</span><span style="color:#676E95;font-style:italic;"> //超链接类型</span></span>
<span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SRC_IMAGE_ANCHOR_TYPE</span><span style="color:#676E95;font-style:italic;"> //带有链接的图片类型</span></span>
<span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IMAGE_TYPE</span><span style="color:#676E95;font-style:italic;"> //单纯的图片类型</span></span>
<span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">EDIT_TEXT_TYPE</span><span style="color:#676E95;font-style:italic;"> //选中的文字类型</span></span>
<span class="line"></span></code></pre></div><p>实现步骤：</p><ol><li>给WebView设置长按监听事件；</li><li>获取WebView长按时的WebView.HitTestResult的事件类型，如果是图片，则做处理。</li></ol><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setOnLongClickListener</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> View</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">OnLongClickListener</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onLongClick</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">View</span><span style="color:#A6ACCD;"> view</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">HitTestResult</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> view</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">getHitTestResult</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">result </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null){</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getType</span><span style="color:#89DDFF;">()){</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#A6ACCD;"> WebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HitTestResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SRC_IMAGE_ANCHOR_TYPE</span><span style="color:#89DDFF;font-style:italic;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> imgUrl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getExtra</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p><strong>3、全屏(Fullscreen)</strong></p><ul><li>当H5请求全屏时，会回调 WebChromeClient.onShowCustomView 方法</li><li>当H5退出全屏时，会回调 WebChromeClient.onHideCustomView 方法</li></ul><ol><li>manifest 自己处理屏幕尺寸方向的变化(切换屏幕方向时不重建activity) WebView播放视频需要开启硬件加速</li></ol><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">activity</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.WebViewActivity</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">configChanges</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">orientation|screenSize</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">hardwareAccelerated</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">screenOrientation</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">portrait</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span></code></pre></div><ol><li>处理全屏回调</li></ol><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">CustomViewCallback</span><span style="color:#A6ACCD;"> mCallback</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">View</span><span style="color:#A6ACCD;"> vCustom</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onShowCustomView</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">View</span><span style="color:#A6ACCD;"> view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">CustomViewCallback</span><span style="color:#A6ACCD;"> callback</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">setFullscreen</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"><span style="color:#A6ACCD;">    vCustom </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> view</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    mCallback </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> callback</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">vCustom </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ViewGroup</span><span style="color:#A6ACCD;"> parent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ViewGroup</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> vWeb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getParent</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        parent</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">vCustom</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onHideCustomView</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">setFullscreen</span><span style="color:#89DDFF;">(false);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">vCustom </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ViewGroup</span><span style="color:#A6ACCD;"> parent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ViewGroup</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> vWeb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getParent</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        parent</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">removeView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">vCustom</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        vCustom </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">mCallback </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        mCallback</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onCustomViewHidden</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        mCallback </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><ol><li>设置全屏，切换屏幕方向</li></ol><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">setFullscreen</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> fullscreen</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fullscreen</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">getWindow</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">clearFlags</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">WindowManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LayoutParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FLAG_FORCE_NOT_FULLSCREEN</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">getWindow</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">setFlags</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">WindowManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LayoutParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FLAG_FULLSCREEN</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> WindowManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LayoutParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FLAG_FULLSCREEN</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        vToolbar</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setVisibility</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">View</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GONE</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        vWeb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setVisibility</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">View</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GONE</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">getWindow</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">clearFlags</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">WindowManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LayoutParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FLAG_FULLSCREEN</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">getWindow</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">setFlags</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">WindowManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LayoutParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FLAG_FORCE_NOT_FULLSCREEN</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> WindowManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LayoutParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FLAG_FORCE_NOT_FULLSCREEN</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        vToolbar</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setVisibility</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">View</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VISIBLE</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        vWeb</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setVisibility</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">View</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VISIBLE</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">getResources</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getConfiguration</span><span style="color:#89DDFF;">().</span><span style="color:#A6ACCD;">orientation </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> Configuration</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ORIENTATION_PORTRAIT</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">setRequestedOrientation</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ActivityInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SCREEN_ORIENTATION_LANDSCAPE</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">setRequestedOrientation</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ActivityInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SCREEN_ORIENTATION_PORTRAIT</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h6 id="webview与javascript交互" tabindex="-1">WebView与Javascript交互 <a class="header-anchor" href="#webview与javascript交互" aria-hidden="true">#</a></h6><blockquote><p>JavaScript 和 Android 可以交互，我们可以在网页中随意调用本地的 Java 代码，实现了 WebView 和本地代码的交互。所以 WebView 的功能非常强大，我们直接在一个 WebView 中就几乎可以实现 Android 的所有功能，所以现在才会出现不少纯 HTML5 开发的 App，这往往适合创业型公司刚起步阶段。</p></blockquote><p>Android与JS通过WebView互相调用方法，实际上是：</p><ul><li>Android去调用JS的代码</li><li>JS去调用Android的代码</li></ul><blockquote><p>二者沟通的桥梁是WebView</p></blockquote><hr><ol><li>通过WebView的loadUrl()</li><li>通过WebView的evaluateJavascript()</li></ol><p><strong>方式1：通过WebView的loadUrl()</strong> 同步调用，会导致JS页面刷新。</p><ul><li>实例介绍：点击Android按钮，即调用WebView JS（文本名为javascript）中callJS()</li><li>具体实现：</li></ul><p>步骤1：将需要调用的JS代码以.html格式放到src/main/assets文件夹里</p><blockquote><p>为了方便展示，本文是采用Andorid调用本地JS代码说明；实际情况时，Android更多的是调用远程JS代码，即将加载的JS代码路径改成url即可</p></blockquote><p><em>需要加载JS代码：javascript.html</em></p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F78C6C;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">webview</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!--Android需要调用的方法--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   function callJS(){</span></span>
<span class="line"><span style="color:#A6ACCD;">      alert(&quot;Android调用了JS的callJS()方法&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">   }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>步骤2：在Android里通过WebView设置调用JS代码 <em>Android代码：MainActivity.java</em></p><blockquote><p>注释已经非常清楚了</p></blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MainActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">AppCompatActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">Button</span><span style="color:#A6ACCD;"> mButton</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> mWebView</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Bundle</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">savedInstanceState</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">savedInstanceState</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">setContentView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">layout</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activity_main</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        mButton </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">btn</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">webview</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">WebSettings</span><span style="color:#A6ACCD;"> webSettings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 设置与Js交互的权限</span></span>
<span class="line"><span style="color:#A6ACCD;">        webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 设置允许JS弹窗</span></span>
<span class="line"><span style="color:#A6ACCD;">        webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptCanOpenWindowsAutomatically</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 由于设置了弹窗检验调用结果,所以需要支持js对话框</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// webview只是载体，内容的渲染需要使用webviewChromClient类去实现</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 通过设置WebChromeClient对象处理JavaScript的对话框</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//设置响应js 的Alert()函数</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebChromeClient</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebChromeClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onJsAlert</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">message</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">JsResult</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#C792EA;">AlertDialog</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">Builder</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> AlertDialog</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Builder</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MainActivity</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">this</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                b</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setTitle</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Alert</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                b</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setMessage</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">message</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                b</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setPositiveButton</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">android</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">string</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ok</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> DialogInterface</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">OnClickListener</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onClick</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">DialogInterface</span><span style="color:#A6ACCD;"> dialog</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> which</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                        result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">confirm</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">                b</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCancelable</span><span style="color:#89DDFF;">(false);</span></span>
<span class="line"><span style="color:#A6ACCD;">                b</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">show</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 先载入JS代码</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 格式规定为:file:///android_asset/文件名.html</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file:///android_asset/javascript.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        mButton</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setOnClickListener</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> View</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">OnClickListener</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onClick</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">View</span><span style="color:#A6ACCD;"> v</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// 通过Handler发送消息</span></span>
<span class="line"><span style="color:#A6ACCD;">                mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Runnable</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                        </span><span style="color:#676E95;font-style:italic;">// 注意调用的JS方法名要对应上</span></span>
<span class="line"><span style="color:#89DDFF;">                        </span><span style="color:#676E95;font-style:italic;">// 调用javascript的callJS()方法</span></span>
<span class="line"><span style="color:#A6ACCD;">                        mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">javascript:callJS()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-16546162722232.webp" alt="img"></p><p><strong>特别注意：JS代码调用一定要在 onPageFinished（） 回调之后才能调用，否则不会调用。</strong></p><blockquote><p>onPageFinished()属于WebViewClient类的方法，主要在页面加载结束时调用</p></blockquote><p><strong>方式2：通过WebView的evaluateJavascript()</strong> 异步执行调用JS，并通过回调返回值，不会使JS页面刷新</p><blockquote><p>优点：该方法比第一种方法效率更高、使用更简洁。 限制：API&gt;=19</p></blockquote><ul><li>具体实现：</li></ul><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (Build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VERSION</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SDK_INT </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> Build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VERSION_CODES</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">KITKAT) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">evaluateJavascript</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">javascript:callJS()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ValueCallback</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              @</span><span style="color:#A6ACCD;">Override</span></span>
<span class="line"><span style="color:#F07178;">              public void onReceiveValue</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                     </span><span style="color:#676E95;font-style:italic;">//此处为 js 返回的结果</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>方式对比</strong></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-16546163124854.webp" alt="img"></p><p><strong>使用建议</strong> 两种方法混合使用，即Android 4.4以下使用方法1，Android 4.4以上方法2</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (Build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VERSION</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SDK_INT </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> Build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">VERSION_CODES</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">KITKAT) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">evaluateJavascript</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">javascript:callJS()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ValueCallback</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">               @</span><span style="color:#A6ACCD;">Override</span></span>
<span class="line"><span style="color:#F07178;">                public void onReceiveValue</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                       </span><span style="color:#676E95;font-style:italic;">//此处为 js 返回的结果</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">javascript:callJS()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h6 id="js调用android代码" tabindex="-1">JS调用Android代码 <a class="header-anchor" href="#js调用android代码" aria-hidden="true">#</a></h6><p><strong>JS通过调用 Android 代码的方法有3种：</strong></p><ol><li>通过WebView的addJavascriptInterface()进行对象映射</li><li>通过 WebViewClient 的shouldOverrideUrlLoading ()方法回调拦截 url</li><li>通过 WebChromeClient 的onJsAlert()、onJsConfirm()、onJsPrompt()方法回调拦截JS对话框alert()、confirm()、prompt() 消息</li></ol><p><strong>方式1：通过 WebView的addJavascriptInterface()进行对象映射</strong> 步骤1：定义一个与JS对象映射关系的Android类 <em>AndroidtoJs.java</em></p><blockquote><p>注释已经非常清楚了</p></blockquote><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">AndroidtoJs</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 定义JS需要调用的方法</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 被JS调用的方法必须加入@JavascriptInterface注解</span></span>
<span class="line"><span style="color:#A6ACCD;">    @JavascriptInterface</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">hello</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">msg</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">JS调用了Android的hello方法</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>步骤2：将需要调用的JS代码以.html格式放到src/main/assets文件夹里 <em>需要加载JS代码：javascript.html</em></p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F78C6C;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">webview</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">         function callAndroid(){</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;">&lt;!-- 由于对象映射，所以调用test对象等于调用Android映射的对象--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            test.hello(&quot;js调用了android中的hello方法&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">         }</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;">&lt;!--点击按钮则调用callAndroid函数--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">button</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">button1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onclick</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">callAndroid()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>步骤3：在Android里通过WebView设置Android类与JS代码的映射 <em>Android代码：MainActivity.java</em></p><blockquote><p>注释已经非常清楚了</p></blockquote><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MainActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">AppCompatActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> mWebView</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Bundle</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">savedInstanceState</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">savedInstanceState</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">setContentView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">layout</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activity_main</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">webview</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">WebSettings</span><span style="color:#A6ACCD;"> webSettings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 设置与Js交互的权限</span></span>
<span class="line"><span style="color:#A6ACCD;">        webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 通过addJavascriptInterface()将Java对象映射到JS对象</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//参数1：Javascript对象名</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//参数2：Java对象名</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addJavascriptInterface</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AndroidtoJs</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;">//AndroidtoJS类对象映射到js的test对象</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 加载JS代码</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 格式规定为:file:///android_asset/文件名.html</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file:///android_asset/javascript.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-16546185726496.webp" alt="img"></p><p><strong>特点</strong></p><ul><li>优点：使用简单</li><li>缺点：存在严重的漏洞问题,后文会说明。</li></ul><p><strong>方式2：通过 WebViewClient 的方法shouldOverrideUrlLoading ()回调拦截 url</strong></p><ul><li>具体原理：</li></ul><ol><li>Android通过 WebViewClient 的回调方法shouldOverrideUrlLoading ()拦截 url</li><li>解析该 url 的协议</li><li>如果检测到是预先约定好的协议，就调用相应方法</li></ol><ul><li>具体实现：</li></ul><p>步骤1：在JS约定所需要的Url协议 <em>JS代码：javascript.html</em></p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F78C6C;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Carson_Ho</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">         function callAndroid(){</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;">&lt;!--约定的url协议为：js://webview?arg1=111&amp;arg2=222--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            document.location = &quot;js://webview?arg1=111&amp;arg2=222&quot;;</span></span>
<span class="line"><span style="color:#A6ACCD;">         }</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">&lt;!-- 点击按钮则调用callAndroid()方法  --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">button</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">button1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onclick</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">callAndroid()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">点击调用Android代码</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>当该JS通过Android的mWebView.loadUrl(&quot;file:///android_asset/javascript.html&quot;)加载后，就会回调shouldOverrideUrlLoading()，接下来继续看步骤2： 步骤2：在Android通过WebViewClient复写shouldOverrideUrlLoading () <em>MainActivity.java</em></p><div class="language-dart"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">public </span><span style="color:#89DDFF;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MainActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">AppCompatActivity</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">WebView</span><span style="color:#A6ACCD;"> mWebView</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    protected </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onCreate</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">Bundle</span><span style="color:#A6ACCD;"> savedInstanceState) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onCreate</span><span style="color:#A6ACCD;">(savedInstanceState)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">setContentView</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">layout</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activity_main)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">webview)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">WebSettings</span><span style="color:#A6ACCD;"> webSettings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 设置与Js交互的权限</span></span>
<span class="line"><span style="color:#A6ACCD;">        webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 设置允许JS弹窗</span></span>
<span class="line"><span style="color:#A6ACCD;">        webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptCanOpenWindowsAutomatically</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 步骤1：加载JS代码</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 格式规定为:file:///android_asset/文件名.html</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#A6ACCD;">(</span><span style="color:#C3E88D;">&quot;file:///android_asset/javascript.html&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 复写WebViewClient类的shouldOverrideUrlLoading方法</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebViewClient</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebViewClient</span><span style="color:#A6ACCD;">() {</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">            public boolean </span><span style="color:#82AAFF;">shouldOverrideUrlLoading</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">WebView</span><span style="color:#A6ACCD;"> view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> url) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;">// 步骤2：根据协议的参数，判断是否是所需要的url</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;">// 一般根据scheme（协议格式） &amp; authority（协议名）判断（前两个参数）</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;">//假定传入进来的 url = &quot;js://webview?arg1=111&amp;arg2=222&quot;（同时也是约定好的需要拦截的）</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#FFCB6B;">Uri</span><span style="color:#A6ACCD;"> uri </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(url)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;">// 如果url的协议 = 预先约定的 js 协议</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;">// 就解析往下解析参数</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getScheme</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#A6ACCD;">(</span><span style="color:#C3E88D;">&quot;js&quot;</span><span style="color:#A6ACCD;">)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#676E95;font-style:italic;">// 如果 authority  = 预先约定协议里的 webview，即代表都符合约定的协议</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#676E95;font-style:italic;">// 所以拦截url,下面JS开始调用Android需要的方法</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAuthority</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#A6ACCD;">(</span><span style="color:#C3E88D;">&quot;webview&quot;</span><span style="color:#A6ACCD;">)) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#676E95;font-style:italic;">//  步骤3：</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#676E95;font-style:italic;">// 执行JS所需要调用的逻辑</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#FFCB6B;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#A6ACCD;">(</span><span style="color:#C3E88D;">&quot;js调用了Android的方法&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#676E95;font-style:italic;">// 可以在协议上带有参数并传递到Android上</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#FFCB6B;">HashMap</span><span style="color:#A6ACCD;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">, </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">&gt; params </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">HashMap</span><span style="color:#A6ACCD;">&lt;&gt;()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#FFCB6B;">Set</span><span style="color:#A6ACCD;">&lt;</span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">&gt; collection </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getQueryParameterNames</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> (</span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> collection) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                            params</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#A6ACCD;">(s</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getQueryParameter</span><span style="color:#A6ACCD;">(s))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                        }</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#FFCB6B;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#A6ACCD;">(uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getQuery</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#FFCB6B;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#A6ACCD;">(params</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                    }</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">                }</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shouldOverrideUrlLoading</span><span style="color:#A6ACCD;">(view</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> url)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">        )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-16546186557168.webp" alt="img"></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461866705710.webp" alt="img"></p><p><strong>特点</strong></p><ul><li>优点：不存在方式1的漏洞；</li><li>缺点：JS获取Android方法的返回值复杂。</li></ul><blockquote><p>如果JS想要得到Android方法的返回值，只能通过 WebView 的 loadUrl （）去执行 JS 方法把返回值传递回去，相关的代码如下：</p></blockquote><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Android：MainActivity.java</span></span>
<span class="line"><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">javascript:returnResult(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// JS：javascript.html</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">returnResult</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">result is</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>方式3：通过 WebChromeClient 的onJsAlert()、onJsConfirm()、onJsPrompt（）方法回调拦截JS对话框alert()、confirm()、prompt（） 消息</strong> 在JS中，有三个常用的对话框方法：</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461869182712.webp" alt="img"></p><ul><li>具体原理：Android通过 WebChromeClient 的onJsAlert()、onJsConfirm()、onJsPrompt（）方法回调分别拦截JS对话框（即上述三个方法），得到他们的消息内容，然后解析即可。</li><li>具体实现：</li></ul><p>下面的例子将用拦截 JS的输入框（即prompt()方法）说明 ：</p><blockquote><p>常用的拦截是：拦截 JS的输入框（即prompt()方法）,因为只有prompt()可以返回任意类型的值，操作最全面方便、更加灵活；而alert()对话框没有返回值；confirm()对话框只能返回两种状态（确定 / 取消）两个值</p></blockquote><p>步骤1：加载JS代码，如下： <em>javascript.html</em></p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F78C6C;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">webview</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    function clickprompt(){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">&lt;!-- 调用prompt()--&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        var result=prompt(&quot;js://webview?arg1=111&amp;arg2=222&quot;);</span></span>
<span class="line"><span style="color:#A6ACCD;">        alert(&quot;demo &quot; + result);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">&lt;!-- 点击按钮则调用clickprompt()--&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">button</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">button1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">onclick</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">clickprompt()</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">点击调用Android代码</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>当使用mWebView.loadUrl(&quot;file:///android_asset/javascript.html&quot;)加载了上述JS代码后，就会触发回调onJsPrompt()。</p><blockquote><p>如果是拦截警告框（即alert()），则触发回调onJsAlert()； 如果是拦截确认框（即confirm()），则触发回调onJsConfirm()；</p></blockquote><p>步骤2：在Android通过WebChromeClient复写onJsPrompt()</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">public </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MainActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">AppCompatActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    WebView </span><span style="color:#F07178;">mWebView</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">Bundle</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">savedInstanceState</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onCreate</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">savedInstanceState</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">setContentView</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">layout</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activity_main</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">mWebView</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">webview</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">WebSettings</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">webSettings</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 设置与Js交互的权限</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 设置允许JS弹窗</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">webSettings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptCanOpenWindowsAutomatically</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 先加载JS代码</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 格式规定为:file:///android_asset/文件名.html</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file:///android_asset/javascript.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setWebChromeClient</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">WebChromeClient</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                                    </span><span style="color:#676E95;font-style:italic;">// 拦截输入框(原理同方式2)</span></span>
<span class="line"><span style="color:#89DDFF;">                                    </span><span style="color:#676E95;font-style:italic;">// 参数message:代表promt（）的内容（不是url）</span></span>
<span class="line"><span style="color:#89DDFF;">                                    </span><span style="color:#676E95;font-style:italic;">// 参数result:代表输入框的返回值</span></span>
<span class="line"><span style="color:#F07178;">                                    @</span><span style="color:#A6ACCD;">Override</span></span>
<span class="line"><span style="color:#F07178;">                                    public boolean onJsPrompt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">WebView</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">message</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">defaultValue</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">JsPromptResult</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 根据协议的参数，判断是否是所需要的url(原理同方式2)</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 一般根据scheme（协议格式） &amp; authority（协议名）判断（前两个参数）</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">//假定传入进来的 url = &quot;js://webview?arg1=111&amp;arg2=222&quot;（同时也是约定好的需要拦截的）</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">Uri</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 如果url的协议 = 预先约定的 js 协议</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 就解析往下解析参数</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getScheme</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// 如果 authority  = 预先约定协议里的 webview，即代表都符合约定的协议</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// 所以拦截url,下面JS开始调用Android需要的方法</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAuthority</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">webview</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                    </span><span style="color:#676E95;font-style:italic;">// 执行JS所需要调用的逻辑</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">js调用了Android的方法</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">                    </span><span style="color:#676E95;font-style:italic;">// 可以在协议上带有参数并传递到Android上</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">HashMap</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">params</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">HashMap</span><span style="color:#89DDFF;">&lt;&gt;</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">Set</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">collection</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getQueryParameterNames</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;"> : </span><span style="color:#A6ACCD;">collection</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getQueryParameter</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">s</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">uri</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getQuery</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">params</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">                    </span><span style="color:#676E95;font-style:italic;">//参数result:代表消息框的返回值(输入值)</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">confirm</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">js调用了Android的方法成功啦</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onJsPrompt</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">message</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defaultValue</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 通过alert()和confirm()拦截的原理相同，此处不作过多讲述</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 拦截JS的警告框</span></span>
<span class="line"><span style="color:#F07178;">        @</span><span style="color:#A6ACCD;">Override</span></span>
<span class="line"><span style="color:#F07178;">        public boolean onJsAlert</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">WebView</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">message</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">JsResult</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onJsAlert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">message</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 拦截JS的确认框</span></span>
<span class="line"><span style="color:#F07178;">        @</span><span style="color:#A6ACCD;">Override</span></span>
<span class="line"><span style="color:#F07178;">        public boolean onJsConfirm</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">WebView</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">String</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">message</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">JsResult</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onJsConfirm</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">message</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461872835014.webp" alt="img"></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461873690616.webp" alt="img"></p><p><strong>三种方式的对比 &amp; 使用场景</strong></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461875082618.webp" alt="img"></p><h6 id="webview与android交互总结" tabindex="-1">webview与android交互总结 <a class="header-anchor" href="#webview与android交互总结" aria-hidden="true">#</a></h6><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/img944365-613b57c93dff2eb8.png" alt="img"></p><h6 id="webview的使用漏洞" tabindex="-1">WebView的使用漏洞 <a class="header-anchor" href="#webview的使用漏洞" aria-hidden="true">#</a></h6><p><strong>1. 类型</strong></p><p>WebView中，主要漏洞有三类：</p><ul><li>任意代码执行漏洞</li><li>密码明文存储漏洞</li><li>域控制不严格漏洞</li></ul><p><strong>2. 具体分析</strong></p><p><strong>第一类：WebView 任意代码执行漏洞</strong> 出现该漏洞的原因有三个：</p><ul><li>WebView 中 addJavascriptInterface() 接口</li><li>WebView 内置导出的 searchBoxJavaBridge_对象</li><li>WebView 内置导出的 accessibility 和 accessibilityTraversalObject 对象</li></ul><p><strong>原因一：addJavascriptInterface 接口引起远程代码执行漏洞</strong> 漏洞产生原因： JS调用Android的其中一个方式是通过addJavascriptInterface接口进行对象映射：</p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 参数1：Android的本地对象</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 参数2：JS的对象</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 通过对象映射将Android中的本地对象和JS中的对象进行关联，从而实现JS调用Android的对象和方法</span></span>
<span class="line"><span style="color:#A6ACCD;"> webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addJavascriptInterface</span><span style="color:#89DDFF;">(new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">JSObject</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">myObj</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>所以，漏洞产生原因是：当JS拿到Android这个对象后，就可以调用这个Android对象中所有的方法，包括系统类（java.lang.Runtime 类），从而进行任意代码执行。如可以执行命令获取本地设备的SD卡中的文件等信息从而造成信息泄露。</p><blockquote><p>具体获取系统类的原理描述：（结合 Java 反射机制）</p><ol><li>Android中的对象有一公共的方法：getClass()</li><li>该方法可以获取到当前类的类型Class</li><li>该类有一关键的方法： Class.forName,</li><li>该方法可以加载一个类（可加载 java.lang.Runtime 类）,而该类是可以执行本地命令的。</li></ol></blockquote><p>以下是攻击的Js核心代码：</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">cmdArgs</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 步骤1：遍历 window 对象</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 目的是为了找到包含 getClass()的对象</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 因为Android映射的JS对象也在window中，所以肯定会遍历到</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">getClass</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 步骤2：利用反射调用forName()得到Runtime类对象</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">          </span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">obj</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getClass</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forName</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">java.lang.Runtime</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)  </span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 步骤3：以后，就可以调用静态方法来执行一些命令，比如访问文件的命令</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">getMethod</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">getRuntime</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,null</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">invoke</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">null,null</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exec</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cmdArgs</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 从执行命令后返回的输入流中得到字符串，有很严重暴露隐私的危险。</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 如执行完访问文件的命令之后，就可以得到文件名的信息了。</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">   </span></span>
<span class="line"></span></code></pre></div><p>当一些 APP 通过扫描二维码打开一个外部网页时，攻击者就可以执行这段 js 代码进行漏洞攻击。 在微信盛行、扫一扫行为普及的情况下，该漏洞的危险性非常大。 <strong>解决方案</strong></p><ul><li>Android 4.2版本之后 Google 在Android 4.2 版本中规定对被调用的函数以 @JavascriptInterface进行注解从而避免漏洞攻击</li><li>Android 4.2版本之前 在Android 4.2版本之前采用拦截prompt()进行漏洞修复。具体步骤如下：</li></ul><ol><li>继承 WebView ，重写 addJavascriptInterface 方法，然后在内部自己维护一个对象映射关系的 Map,将需要添加的 JS 接口放入该Map中；</li><li>每次当 WebView 加载页面前加载一段本地的 JS 代码，原理是：</li></ol><blockquote><p>让JS调用一Javascript方法：该方法是通过调用prompt()把JS中的信息（含特定标识，方法名称等）传递到Android端； 在Android的onJsPrompt()中 ，解析传递过来的信息，再通过反射机制调用Java对象的方法，这样实现安全的JS调用Android代码。 关于Android返回给JS的值：可通过prompt()把Java中方法的处理结果返回到Js中</p></blockquote><p>具体需要加载的JS代码如下：</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">javascript</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">JsAddJavascriptInterface_</span><span style="color:#89DDFF;">(){</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// window.jsInterface 表示在window上声明了一个Js对象</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// jsInterface = 注册的对象名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 它注册了两个方法，onButtonClick(arg0)和onImageClick(arg0, arg1, arg2)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 如果有返回值，就添加上return</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">jsInterface</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">!=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">undefined</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">      </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">window.jsInterface_js_interface_name is exist!!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;}</span><span style="color:#F07178;">   </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">jsInterface</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">     </span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 声明方法形式：方法名: function(参数)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">onButtonClick</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">arg0</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">   </span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// prompt()返回约定的字符串</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 该字符串可自己定义</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 包含特定的标识符MyApp和 JSON 字符串（方法名，参数，对象名等）    </span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">prompt</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MyApp:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">obj</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsInterface</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">func</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">onButtonClick</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">args</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">arg0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">onImageClick</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">arg0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">arg1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">arg2</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">   </span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">prompt</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MyApp:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">obj</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsInterface</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">func</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">onImageClick</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">args</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">arg0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">arg1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">arg2</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">};</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">)()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 当JS调用 onButtonClick（） 或 onImageClick（） 时，就会回调到Android中的 onJsPrompt （）</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 我们解析出方法名，参数，对象名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 再通过反射机制调用Java对象的方法</span></span>
<span class="line"></span></code></pre></div><p>关于该方法的其他细节</p><ol><li>加载上述JS代码的时机 由于当 WebView 跳转到下一个页面时，之前加载的 JS 可能已经失效，所以，通常需要在以下方法中加载 JS：</li></ol><div class="language-undefined"><button title="Copy Code" class="copy"></button><span class="lang">undefined</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">onLoadResource（）；</span></span>
<span class="line"><span style="color:#A6ACCD;">doUpdateVisitedHistory（）；</span></span>
<span class="line"><span style="color:#A6ACCD;">onPageStarted（）；</span></span>
<span class="line"><span style="color:#A6ACCD;">onPageFinished（）；</span></span>
<span class="line"><span style="color:#A6ACCD;">onReceivedTitle（）；</span></span>
<span class="line"><span style="color:#A6ACCD;">onProgressChanged（）；</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ol><li>需要过滤掉 Object 类的方法 由于最终是通过反射得到Android指定对象的方法，所以同时也会得到基类的其他方法（最顶层的基类是 Object类）,为了不把 getClass()等方法注入到 JS 中，我们需要把 Object 的共有方法过滤掉，需要过滤的方法列表如下：</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">getClass</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">hashCode</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">notify</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">notifyAl</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">equals</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">toString</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">wait</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p><strong>原因二：searchBoxJavaBridge_接口引起远程代码执行漏洞</strong> 漏洞产生原因： 在Android 3.0以下，Android系统会默认通过searchBoxJavaBridge_的Js接口给 WebView 添加一个JS映射对象：searchBoxJavaBridge_对象,该接口可能被利用，实现远程任意代码。 <strong>解决方案</strong> 删除searchBoxJavaBridge_接口</p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 通过调用该方法删除接口</span></span>
<span class="line"><span style="color:#82AAFF;">removeJavascriptInterface</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><p><strong>原因三：accessibility和 accessibilityTraversal接口引起远程代码执行漏洞</strong> 问题分析与解决方案同上，这里不作过多阐述。 <strong>第二类：密码明文存储漏洞</strong><strong>漏洞原因：</strong> WebView默认开启密码保存功能</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mWebView.setSavePassword(</span><span style="color:#82AAFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>开启后，在用户输入密码时，会弹出提示框：询问用户是否保存密码； 如果选择”是”，密码会被明文保到 /data/data/com.package.name/databases/webview.db 中，这样就有被盗取密码的危险 <strong>解决方案</strong> 关闭密码保存提醒</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">WebSettings.setSavePassword(</span><span style="color:#82AAFF;">false</span><span style="color:#A6ACCD;">) </span></span>
<span class="line"></span></code></pre></div><p><strong>第三类：域控制不严格漏洞</strong> 漏洞原因： 先看Android里的* WebViewActivity.java*：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebViewActivity</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Activity</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">WebView</span><span style="color:#A6ACCD;"> webView</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Bundle</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">savedInstanceState</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onCreate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">savedInstanceState</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">setContentView</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">layout</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activity_webview</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        webView </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findViewById</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//webView.getSettings().setAllowFileAccess(false);                    (1)</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//webView.getSettings().setAllowFileAccessFromFileURLs(true);         (2)</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//webView.getSettings().setAllowUniversalAccessFromFileURLs(true);    (3)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Intent</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getIntent</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getData</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">toString</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//url = file:///data/local/tmp/attack.html </span></span>
<span class="line"><span style="color:#A6ACCD;">        webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadUrl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**Mainifest.xml**/</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 将该 WebViewActivity 在Mainifest.xml设置exported属性</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 表示：当前Activity是否可以被另一个Application的组件启动</span></span>
<span class="line"><span style="color:#A6ACCD;">android</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;">exported</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>即 A 应用可以通过 B 应用导出的 Activity 让 B 应用加载一个恶意的 file 协议的 url，从而可以获取 B 应用的内部私有文件，从而带来数据泄露威胁</p><blockquote><p>具体：当其他应用启动此 Activity 时， intent 中的 data 直接被当作 url 来加载（假定传进来的 url 为 file:///data/local/tmp/attack.html ），其他 APP 通过使用显式 ComponentName 或者其他类似方式就可以很轻松的启动该 WebViewActivity 并加载恶意url。 下面我们着重分析WebView中getSettings类的方法对 WebView 安全性的影响：</p></blockquote><ul><li>setAllowFileAccess()</li><li>setAllowFileAccessFromFileURLs()</li><li>setAllowUniversalAccessFromFileURLs()</li></ul><p><strong>1. setAllowFileAccess()</strong></p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 设置是否允许 WebView 使用 File 协议</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 默认设置为true，即允许在 File 域下执行任意 JavaScript 代码</span></span>
<span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">setAllowFileAccess</span><span style="color:#89DDFF;">(true);</span><span style="color:#A6ACCD;">     </span></span>
<span class="line"></span></code></pre></div><p>使用 file 域加载的 js代码能够使用同源策略跨域访问，从而导致隐私信息泄露</p><blockquote><ul><li>同源策略跨域访问：对私有目录文件进行访问</li><li>针对 IM 类产品，泄露的是聊天信息、联系人等等</li><li>针对浏览器类软件，泄露的是cookie 信息泄露。</li></ul></blockquote><p>如果不允许使用 file 协议，则不会存在上述的威胁；</p><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">webView.getSettings()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">setAllowFileAccess(false);     </span></span>
<span class="line"></span></code></pre></div><p>但同时也限制了 WebView 的功能，使其不能加载本地的 html 文件，如下图： 移动版的 Chrome 默认禁止加载 file 协议的文件</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461887884922.webp" alt="img"></p><p><strong>解决方案</strong></p><ul><li>对于不需要使用 file 协议的应用，禁用 file 协议；</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">setAllowFileAccess(</span><span style="color:#82AAFF;">false</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><ul><li>对于需要使用 file 协议的应用，禁止 file 协议加载 JavaScript。</li></ul><div class="language-swift"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">setAllowFileAccess</span><span style="color:#89DDFF;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">; </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 禁止 file 协议加载 JavaScript</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">url.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file://</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#89DDFF;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#89DDFF;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>2. setAllowFileAccessFromFileURLs()</strong></p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 设置是否允许通过 file url 加载的 Js代码读取其他的本地文件</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 在Android 4.1前默认允许</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 在Android 4.1后默认禁止</span></span>
<span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">setAllowFileAccessFromFileURLs</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"></span></code></pre></div><p>当AllowFileAccessFromFileURLs（）设置为 true 时，攻击者的JS代码为：</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">function loadXMLDoc()</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    var arm = &quot;file:///etc/hosts&quot;;</span></span>
<span class="line"><span style="color:#A6ACCD;">    var xmlhttp;</span></span>
<span class="line"><span style="color:#A6ACCD;">    if (window.XMLHttpRequest)</span></span>
<span class="line"><span style="color:#A6ACCD;">    {</span></span>
<span class="line"><span style="color:#A6ACCD;">        xmlhttp=new XMLHttpRequest();</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    xmlhttp.onreadystatechange=function()</span></span>
<span class="line"><span style="color:#A6ACCD;">    {</span></span>
<span class="line"><span style="color:#A6ACCD;">        //alert(&quot;status is&quot;+xmlhttp.status);</span></span>
<span class="line"><span style="color:#A6ACCD;">        if (xmlhttp.readyState==4)</span></span>
<span class="line"><span style="color:#A6ACCD;">        {</span></span>
<span class="line"><span style="color:#A6ACCD;">              console.log(xmlhttp.responseText);</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    xmlhttp.open(&quot;GET&quot;,arm);</span></span>
<span class="line"><span style="color:#A6ACCD;">    xmlhttp.send(null);</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">loadXMLDoc();</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// 通过该代码可成功读取 /etc/hosts 的内容数据</span></span>
<span class="line"></span></code></pre></div><p><strong>解决方案</strong> 禁用 file url 加载的 Js代码读取其他的本地文件</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">setAllowFileAccessFromFileURLs(</span><span style="color:#82AAFF;">false</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>当设置成为 false 时，上述JS的攻击代码执行会导致错误，表示浏览器禁止从 file url 中的 javascript 读取其它本地文件。 <strong>3. setAllowUniversalAccessFromFileURLs()</strong></p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 设置是否允许通过 file url 加载的 Javascript 可以访问其他的源(包括http、https等源)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 在Android 4.1前默认允许（setAllowFileAccessFromFileURLs（）不起作用）</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 在Android 4.1后默认禁止</span></span>
<span class="line"><span style="color:#A6ACCD;">webView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">setAllowUniversalAccessFromFileURLs</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"></span></code></pre></div><p>当AllowFileAccessFromFileURLs（）被设置成true时，攻击者的JS代码是：</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 通过该代码可成功读取 http://www.so.com 的内容</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">function loadXMLDoc()</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    var arm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://www.so.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    var xmlhttp;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">if</span><span style="color:#A6ACCD;"> (window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">XMLHttpRequest)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        xmlhttp</span><span style="color:#89DDFF;">=new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">XMLHttpRequest</span><span style="color:#A6ACCD;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    xmlhttp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onreadystatechange</span><span style="color:#89DDFF;">=</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//alert(&quot;status is&quot;+xmlhttp.status);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">xmlhttp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">readyState</span><span style="color:#89DDFF;">==</span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">             </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">xmlhttp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">responseText</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    xmlhttp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">arm);</span></span>
<span class="line"><span style="color:#A6ACCD;">    xmlhttp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">loadXMLDoc();</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p><strong>解决方案</strong>：设置setAllowUniversalAccessFromFileURLs(false); <strong>4. setJavaScriptEnabled()</strong> // 设置是否允许 WebView 使用 JavaScript（默认是不允许） // 但很多应用（包括移动浏览器）为了让 WebView 执行 http 协议中的 JavaScript，都会主动设置为true，不区别对待是非常危险的。 webView.getSettings().setJavaScriptEnabled(true); 即使把setAllowFileAccessFromFileURLs（）和setAllowUniversalAccessFromFileURLs（）都设置为 false，通过 file URL 加载的 javascript 仍然有方法访问其他的本地文件：符号链接跨源攻击</p><blockquote><p>前提是允许 file URL 执行 javascript，即webView.getSettings().setJavaScriptEnabled(true);</p></blockquote><p>这一攻击能奏效的原因是：通过 javascript 的延时执行和将当前文件替换成指向其它文件的软链接就可以读取到被符号链接所指的文件。具体攻击步骤：</p><ol><li>把恶意的 js 代码输出到攻击应用的目录下，随机命名为 xx.html，修改该目录的权限；</li><li>修改后休眠 1s，让文件操作完成；</li><li>完成后通过系统的 Chrome 应用去打开该 xx.html 文件</li><li>等待 4s 让 Chrome 加载完成该 html，最后将该 html 删除，并且使用 ln -s 命令为 Chrome 的 Cookie 文件创建软连接</li></ol><blockquote><p>注：在该命令执行前 xx.html 是不存在的；执行完这条命令之后，就生成了这个文件，并且将 Cookie 文件链接到了 xx.html 上。</p></blockquote><p>于是就可通过链接来访问 Chrome 的 Cookie</p><blockquote><p>Google 没有进行修复，只是让Chrome 最新版本默认禁用 file 协议，所以这一漏洞在最新版的 Chrome 中并不存在，但是，在日常大量使用 WebView 的App和浏览器，都有可能受到此漏洞的影响。通过利用此漏洞，容易出现数据泄露的危险</p></blockquote><p>如果是 file 协议，禁用 javascript 可以很大程度上减小跨源漏洞对 WebView 的威胁。但并不能完全杜绝跨源文件泄露。</p><blockquote><p>例：应用实现了下载功能，对于无法加载的页面，会自动下载到 sd 卡中；由于 sd 卡中的文件所有应用都可以访问，于是可以通过构造一个 file URL 指向被攻击应用的私有文件，然后用此 URL 启动被攻击应用的 WebActivity，这样由于该 WebActivity 无法加载该文件，就会将该文件下载到 sd 卡下面，然后就可以从 sd 卡上读取这个文件了</p></blockquote><p><strong>最终解决方案</strong></p><ul><li>对于不需要使用 file 协议的应用，禁用 file 协议；</li></ul><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 禁用 file 协议；</span></span>
<span class="line"><span style="color:#82AAFF;">setAllowFileAccess</span><span style="color:#89DDFF;">(false);</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#82AAFF;">setAllowFileAccessFromFileURLs</span><span style="color:#89DDFF;">(false);</span></span>
<span class="line"><span style="color:#82AAFF;">setAllowUniversalAccessFromFileURLs</span><span style="color:#89DDFF;">(false);</span></span>
<span class="line"></span></code></pre></div><ul><li>对于需要使用 file 协议的应用，禁止 file 协议加载 JavaScript。</li></ul><div class="language-swift"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 需要使用 file 协议</span></span>
<span class="line"><span style="color:#82AAFF;">setAllowFileAccess</span><span style="color:#89DDFF;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">; </span></span>
<span class="line"><span style="color:#82AAFF;">setAllowFileAccessFromFileURLs</span><span style="color:#89DDFF;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#82AAFF;">setAllowUniversalAccessFromFileURLs</span><span style="color:#89DDFF;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 禁止 file 协议加载 JavaScript</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">url.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">file://</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#89DDFF;">(</span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#89DDFF;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h6 id="webview及前端h5缓存机制" tabindex="-1">WebView及前端H5缓存机制 <a class="header-anchor" href="#webview及前端h5缓存机制" aria-hidden="true">#</a></h6><p><strong>前端H5的缓存机制</strong></p><ul><li>定义 缓存，即离线存储</li></ul><blockquote><ol><li>这意味着 H5网页 加载后会存储在缓存区域，在无网络连接时也可访问</li><li>WebView的本质 = 在 Android中嵌入 H5页面，所以，Android WebView自带的缓存机制其实就是 H5页面的缓存机制</li></ol></blockquote><ul><li>作用</li></ul><ol><li>离线浏览：用户可在没有网络连接时进行H5页面访问</li><li>提高页面加载速度 &amp; 减少流量消耗：直接使用已缓存的资源，不需要重新加载</li></ol><ul><li>具体应用 此处讲解主要讲解 前端H5的缓存机制 的缓存机制 &amp; 缓存模式 ： a. 缓存机制：如何将加载过的网页数据保存到本地 b. 缓存模式：加载网页时如何读取之前保存到本地的网页缓存</li></ul><blockquote><p>前者是保存，后者是读取，请注意区别</p></blockquote><p><strong>缓存机制</strong></p><p><strong>浏览器缓存机制</strong><strong>原理</strong> 根据 HTTP 协议头里的 Cache-Control（或 Expires）和 Last-Modified（或 Etag）等字段来控制文件缓存的机制，下面详细介绍Cache-Control、Expires、Last-Modified &amp; Etag四个字段：</p><ul><li>Cache-Control：用于控制文件在本地缓存有效时长</li></ul><blockquote><p>如服务器回包：Cache-Control:max-age=600，则表示文件在本地应该缓存，且有效时长是600秒（从发出请求算起）。在接下来600秒内，如果有请求这个资源，浏览器不会发出 HTTP 请求，而是直接使用本地缓存的文件。</p></blockquote><ul><li>Expires：与Cache-Control功能相同，即控制缓存的有效时间</li></ul><blockquote><ul><li>Expires是 HTTP1.0 标准中的字段，Cache-Control 是 HTTP1.1 标准中新加的字段</li><li>当这两个字段同时出现时，Cache-Control 优先级较高</li></ul></blockquote><ul><li>Last-Modified：标识文件在服务器上的最新更新时间</li></ul><blockquote><p>下次请求时，如果文件缓存过期，浏览器通过 If-Modified-Since 字段带上这个时间，发送给服务器，由服务器比较时间戳来判断文件是否有修改。如果没有修改，服务器返回304告诉浏览器继续使用缓存；如果有修改，则返回200，同时返回最新的文件。</p></blockquote><ul><li>Etag：功能同Last-Modified ，即标识文件在服务器上的最新更新时间。不同的是，Etag 的取值是一个对文件进行标识的特征字串。</li></ul><blockquote><ul><li>在向服务器查询文件是否有更新时，浏览器通过If-None-Match 字段把特征字串发送给服务器，由服务器和文件最新特征字串进行匹配，来判断文件是否有更新：没有更新回包304，有更新回包200</li><li>Etag 和 Last-Modified 可根据需求使用一个或两个同时使用。两个同时使用时，只要满足基中一个条件，就认为文件没有更新。 <strong>常见用法</strong></li></ul></blockquote><ul><li>Cache-Control与 Last-Modified 一起使用； -Expires与 Etag一起使用； 即一个用于控制缓存有效时间，一个用于在缓存失效后，向服务查询是否有更新</li></ul><blockquote><p>特别注意：浏览器缓存机制 是 浏览器内核的机制，一般都是标准的实现,即Cache-Control、 Last-Modified 、 Expires、 Etag都是标准实现，你不需要操心</p></blockquote><p><strong>特点</strong> 优点：支持 Http协议层 不足：缓存文件需要首次加载后才会产生；浏览器缓存的存储空间有限，缓存有被清除的可能；缓存的文件没有校验。</p><blockquote><p>对于解决以上问题，可以参考手 Q 的离线包</p></blockquote><p><strong>应用场景</strong> 静态资源文件的存储，如JS、CSS、字体、图片等。</p><blockquote><p>Android Webview会将缓存的文件记录及文件内容会存在当前 app 的 data 目录中。</p></blockquote><p><strong>具体实现</strong> 浏览器缓存机制是浏览器内核的机制，一般都是标准的实现,Android WebView内置自动实现，即不需要设置即实现.</p><p><code>Android WebView自带的缓存机制有5种：</code></p><blockquote><ol><li>Application Cache 缓存机制</li><li>Dom Storage 缓存机制</li><li>Web SQL Database 缓存机制</li><li>Indexed Database 缓存机制</li><li>File System 缓存机制（H5页面新加入的缓存机制，虽然Android WebView暂时不支持，但会进行简单介绍）</li></ol></blockquote><p>下面将详细介绍每种缓存机制。</p><p><strong>1. Application Cache 缓存机制</strong></p><p><strong>原理</strong></p><ul><li>以文件为单位进行缓存，且文件有一定更新机制（类似于浏览器缓存机制）</li><li>AppCache 原理有两个关键点：manifest 属性和 manifest 文件。</li></ul><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F78C6C;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">manifest</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo_html.appcache</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">// HTML 在头中通过 manifest 属性引用 manifest 文件</span></span>
<span class="line"><span style="color:#A6ACCD;">// manifest 文件：就是上面以 appcache 结尾的文件，是一个普通文件文件，列出了需要缓存的文件</span></span>
<span class="line"><span style="color:#A6ACCD;">// 浏览器在首次加载 HTML 文件时，会解析 manifest 属性，并读取 manifest 文件，获取 Section：CACHE MANIFEST 下要缓存的文件列表，再对文件缓存</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// 原理说明如下：</span></span>
<span class="line"><span style="color:#A6ACCD;">// AppCache 在首次加载生成后，也有更新机制。被缓存的文件如果要更新，需要更新 manifest 文件</span></span>
<span class="line"><span style="color:#A6ACCD;">// 因为浏览器在下次加载时，除了会默认使用缓存外，还会在后台检查 manifest 文件有没有修改</span></span>
<span class="line"><span style="color:#A6ACCD;">//发现有修改，就会重新获取 manifest 文件，对 Section：CACHE MANIFEST 下文件列表检查更新</span></span>
<span class="line"><span style="color:#A6ACCD;">// manifest 文件与缓存文件的检查更新也遵守浏览器缓存机制</span></span>
<span class="line"><span style="color:#A6ACCD;">// 如用户手动清了 AppCache 缓存，下次加载时，浏览器会重新生成缓存，也可算是一种缓存的更新</span></span>
<span class="line"><span style="color:#A6ACCD;">// AppCache 的缓存文件，与浏览器的缓存文件分开存储的，因为 AppCache 在本地有 5MB（分 HOST）的空间限制</span></span>
<span class="line"></span></code></pre></div><p><strong>特点</strong> 方便构建Web App的缓存</p><blockquote><p>专门为 Web App离线使用而开发的缓存机制</p></blockquote><p><strong>应用场景</strong> 存储静态文件（如JS、CSS、字体文件）,应用场景同浏览器缓存机制,但AppCache 是对 浏览器缓存机制 的补充，不是替代。 <strong>具体实现</strong></p><div class="language-dart"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 通过设置WebView的settings来实现</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">WebSettings</span><span style="color:#A6ACCD;"> settings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getSettings</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;">// 1. 设置缓存路径</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> cacheDirPath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getFilesDir</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAbsolutePath</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">&quot;cache/&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAppCachePath</span><span style="color:#A6ACCD;">(cacheDirPath)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#676E95;font-style:italic;">// 2. 设置缓存大小</span></span>
<span class="line"><span style="color:#A6ACCD;">         settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAppCacheMaxSize</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">1024</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">1024</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;">// 3. 开启Application Cache存储机制</span></span>
<span class="line"><span style="color:#A6ACCD;">        settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAppCacheEnabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>特别注意: 每个 Application 只调用一次 WebSettings.setAppCachePath() 和WebSettings.setAppCacheMaxSize()</p></blockquote><p><strong>2.Dom Storage 缓存机制</strong></p><p><strong>原理</strong> 通过存储字符串的 Key - Value 对来提供.DOM Storage 分为 sessionStorage &amp; localStorage； 二者使用方法基本相同，区别在于作用范围不同：</p><ul><li>sessionStorage：具备临时性，即存储与页面相关的数据，它在页面关闭后无法使用</li><li>localStorage：具备持久性，即保存的数据在页面关闭后也可以使用。 <strong>特点</strong></li><li>存储空间大（ 5MB）：存储空间对于不同浏览器不同，如Cookies 才 4KB</li><li>存储安全、便捷： Dom Storage 存储的数据在本地，不需要经常和服务器进行交互,不像 Cookies每次请求一次页面，都会向服务器发送网络请求</li></ul><p><strong>应用场景</strong> 存储临时、简单的数据</p><blockquote><ul><li>代替 **将 不需要让服务器知道的信息 存储到 cookies **的这种传统方法</li><li>Dom Storage 机制类似于 Android 的 SharedPreference机制 <strong>具体实现</strong></li></ul></blockquote><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">        // 通过设置 \`WebView\`的\`Settings\`类实现</span></span>
<span class="line"><span style="color:#A6ACCD;">        WebSettings settings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        // 开启DOM storage</span></span>
<span class="line"><span style="color:#A6ACCD;">        settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDomStorageEnabled</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"></span></code></pre></div><p><strong><a href="http://3.Web" target="_blank" rel="noreferrer">3.Web</a> SQL Database 缓存机制</strong></p><p><strong>原理</strong> 基于 SQL 的数据库存储机制 <strong>特点</strong> 充分利用数据库的优势，可方便对数据进行增加、删除、修改、查询 <strong>应用场景</strong> 存储适合数据库的结构化数据 <strong>具体实现</strong></p><div class="language-dart"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 通过设置WebView的settings实现</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">WebSettings</span><span style="color:#A6ACCD;"> settings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getSettings</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 设置缓存路径</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> cacheDirPath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> context</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getFilesDir</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAbsolutePath</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">&quot;cache/&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDatabasePath</span><span style="color:#A6ACCD;">(cacheDirPath)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 开启 数据库存储机制</span></span>
<span class="line"><span style="color:#A6ACCD;">        settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDatabaseEnabled</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">true</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>特别说明</strong> 根据官方说明，Web SQL Database存储机制不再推荐使用（不再维护）,取而代之的是 IndexedDB缓存机制，下面会详细介绍</p><p><strong>4.IndexedDB 缓存机制</strong></p><p><strong>原理</strong> 属于 NoSQL 数据库，通过存储字符串的 Key - Value 对来提供,类似于 Dom Storage 存储机制 的key-value存储方式 <strong>特点</strong></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461903508224.webp" alt="img"></p><p><strong>应用场景</strong> 存储 复杂、数据量大的结构化数据 <strong>具体实现</strong></p><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">        // 通过设置WebView的settings实现</span></span>
<span class="line"><span style="color:#A6ACCD;">        WebSettings settings </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        // 只需设置支持JS就自动打开IndexedDB存储机制</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        // Android 在4.4开始加入对 IndexedDB 的支持，只需打开允许 JS 执行的开关就好了。</span></span>
<span class="line"><span style="color:#A6ACCD;">        settings</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setJavaScriptEnabled</span><span style="color:#89DDFF;">(true);</span></span>
<span class="line"></span></code></pre></div><p><strong>5.File System</strong></p><p><strong>原理</strong></p><ul><li>为 H5页面的数据 提供一个虚拟的文件系统</li></ul><blockquote><ul><li>可进行文件（夹）的创建、读、写、删除、遍历等操作，就像 Native App 访问本地文件系统一样</li><li>虚拟的文件系统是运行在沙盒中</li><li>不同 WebApp 的虚拟文件系统是互相隔离的，虚拟文件系统与本地文件系统也是互相隔离的。</li></ul></blockquote><ul><li>虚拟文件系统提供了两种类型的存储空间：临时 &amp; 持久性：</li></ul><blockquote><ul><li>临时的存储空间：由浏览器自动分配，但可能被浏览器回收</li><li>持久性的存储空间：需要显式申请；自己管理（浏览器不会回收，也不会清除内容）；存储空间大小通过配额管理，首次申请时会一个初始的配额，配额用完需要再次申请。 <strong>特点</strong></li><li>可存储数据体积较大的二进制数据</li><li>可预加载资源文件</li><li>可直接编辑文件</li></ul></blockquote><p><strong>应用场景</strong> 通过文件系统 管理数据 <strong>具体使用</strong> 由于 File System是 H5 新加入的缓存机制，所以Android WebView暂时不支持 <strong>缓存机制汇总</strong></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461911149126.webp" alt="img"></p><p><strong>使用建议</strong></p><ul><li>综合上述缓存机制的分析，我们可以根据 需求场景的不同（缓存不同类型的数据场景） 从而选择不同的缓存机制（组合使用）</li><li>以下是缓存机制的使用建议：</li><li><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461913522128.webp" alt="img"></li></ul><p><strong>缓存模式</strong></p><ul><li>定义 缓存模式是一种 当加载H5网页时该如何读取之前保存到本地缓存从而进行使用 的方式,即告诉Android WebView 什么时候去读缓存，以哪种方式去读缓存</li><li>Android WebView 自带的缓存模式有4种：</li></ul><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">      // 缓存模式说明: </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      // LOAD_CACHE_ONLY: 不使用网络，只读取本地缓存数据</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      // LOAD_NO_CACHE: 不使用缓存，只从网络获取数据.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      // LOAD_DEFAULT: （默认）根据cache-control决定是否从网络上取数据。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      // LOAD_CACHE_ELSE_NETWORK，只要本地有，无论是否过期，或者no-cache，都使用缓存中的数据。</span></span>
<span class="line"></span></code></pre></div><ul><li>具体使用</li></ul><div class="language-cpp"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 设置参数即可</span></span>
<span class="line"><span style="color:#A6ACCD;">WebView</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSettings</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">setCacheMode</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">WebSettings</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LOAD_CACHE_ELSE_NETWORK</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><h6 id="webview-存在的性能问题" tabindex="-1">WebView 存在的性能问题 <a class="header-anchor" href="#webview-存在的性能问题" aria-hidden="true">#</a></h6><ul><li>Android WebView 里 H5 页面加载速度慢</li><li>耗费流量</li></ul><p>下面会详细介绍。</p><p><strong>H5页面加载速度慢</strong></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461918341630.webp" alt="img"></p><p>下面会详细介绍： <strong>渲染速度慢</strong> 前端H5页面渲染的速度取决于两个方面：</p><ul><li>Js 解析效率:Js 本身的解析过程复杂、解析速度不快 &amp; 前端页面涉及较多 JS 代码文件，所以叠加起来会导致 Js 解析效率非常低。</li><li>手机硬件设备的性能：由于Android机型碎片化，这导致手机硬件设备的性能不可控，而大多数的Android手机硬件设备无法达到很好很好的硬件性能。</li></ul><p>总结：上述两个原因 导致 H5页面的渲染速度慢。 <strong>页面资源加载缓慢</strong> H5 页面从服务器获得，并存储在 Android手机内存里：</p><ul><li>H5页面一般会比较多</li><li>每加载一个 H5页面，都会产生较多网络请求： 1.HTML 主 URL 自身的请求； 2.HTML外部引用的JS、CSS、字体文件，图片也是一个独立的 HTTP 请求 每一个请求都串行的，这么多请求串起来，这导致 H5页面资源加载缓慢</li></ul><p>总结：H5页面加载速度慢的原因：渲染速度慢 &amp; 页面资源加载缓慢导致。</p><p><strong>耗费流量</strong></p><ul><li>每次使用 H5页面时，用户都需要重新加载 Android WebView的H5 页面</li><li>每加载一个 H5页面，都会产生较多网络请求（上面提到）</li><li>每一个请求都串行的，这么多请求串起来，这导致消耗的流量也会越多</li></ul><p><strong>总结</strong> 综上所述，产生Android WebView性能问题主要原因是：</p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461921134432.webp" alt="img"></p><p>上述问题导致了Android WebView的H5 页面体验 与 原生Native 存在较大差距。</p><p><strong>解决方案</strong></p><p>针对上述Android WebView的性能问题，结合刚刚分析的WebView和h5前端缓存机制延伸出3种优化思路供参考：</p><ul><li>利用WebView和前端H5的缓存机制（WebView 自带）</li><li>资源预加载</li><li>资源拦截 第一种方式在上面已经提到，下面对后面两种方式进行详细介绍：</li></ul><p><strong>资源预加载</strong></p><ul><li>定义 提早加载将需使用的H5页面，即 提前构建缓存，使用时直接取过来用而不用在需要时才去加载。</li><li>具体实现</li></ul><ol><li>预加载WebView对象</li><li>预加载H5资源</li></ol><p><strong>预加载WebView对象</strong></p><ul><li>此处主要分为2方面：首次使用的WebView对象 &amp; 后续使用的WebView对象</li><li>具体如下图</li></ul><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461922492034.webp" alt="img"></p><p><strong>预加载H5资源</strong></p><p><strong>原理</strong> 在应用启动、初始化第一个WebView对象时，直接开始网络请求加载H5页面,后续需打开这些H5页面时就直接从该本地对象中获取。</p><blockquote><p>事先加载常用的H5页面资源（加载后就有缓存了）,此方法虽然不能减小WebView初始化时间，但数据请求和WebView初始化可以并行进行，总体的页面加载时间就缩短了。 <strong>具体实现</strong> 在Android 的BaseApplication里初始化一个WebView对象（用于加载常用的H5页面资源）；当需使用这些页面时再从BaseApplication里取过来直接使用。</p></blockquote><p><strong>应用场景</strong></p><p>对于Android WebView的首页建议使用这种方案，能有效提高首页加载的效率 <strong>自身构建缓存</strong> 为了有效解决 Android WebView 的性能问题，除了使用 Android WebView 自身的缓存机制，还可以自己针对某一需求场景构建缓存机制。 <strong>需求场景</strong></p><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461924213936.webp" alt="img"></p><p><strong>实现步骤</strong></p><ol><li>事先将更新频率较低、常用 &amp; 固定的H5静态资源 文件（如JS、CSS文件、图片等） 放到本地</li><li>拦截H5页面的资源网络请求 并进行检测</li><li>如果检测到本地具有相同的静态资源 就 直接从本地读取进行替换而不发送该资源的网络请求 到 服务器获取</li></ol><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461927297638.webp" alt="img"></p><ol><li><strong>具体实现</strong> 重写WebViewClient 的 shouldInterceptRequest 方法，当向服务器访问这些静态资源时进行拦截，检测到是相同的资源则用本地资源代替</li></ol><div class="language-kotlin"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// 假设现在需要拦截一个图片的资源并用本地资源进行替代</span></span>
<span class="line"><span style="color:#A6ACCD;">        mWebView</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">setWebViewClient</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">new </span><span style="color:#FFCB6B;">WebViewClient</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#676E95;font-style:italic;">// 重写 WebViewClient  的  shouldInterceptRequest （）</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#676E95;font-style:italic;">// API 21 以下用shouldInterceptRequest(WebView view, String url)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#676E95;font-style:italic;">// API 21 以上用shouldInterceptRequest(WebView view, WebResourceRequest request)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#676E95;font-style:italic;">// 下面会详细说明</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#676E95;font-style:italic;">// API 21 以下用shouldInterceptRequest(WebView view, String url)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">public</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">WebResourceResponse</span><span style="color:#F07178;"> shouldInterceptRequest</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">WebView</span><span style="color:#F07178;"> view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#F07178;"> url</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#676E95;font-style:italic;">// 步骤1:判断拦截资源的条件，即判断url里的图片资源的文件名</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#676E95;font-style:italic;">// 假设网页里该图片资源的地址为：http://abc.com/imgage/logo.gif</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#676E95;font-style:italic;">// 图片的资源文件名为:logo.gif</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">contains</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logo.gif</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 步骤2:创建一个输入流</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#FFCB6B;">InputStream</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">is</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#676E95;font-style:italic;">// 步骤3:获得需要替换的资源(存放在assets文件夹里)</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#676E95;font-style:italic;">// a. 先在app/src/main下创建一个assets文件夹</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#676E95;font-style:italic;">// b. 在assets文件夹里再创建一个images文件夹</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#676E95;font-style:italic;">// c. 在images文件夹放上需要替换的资源（此处替换的是abc.png图片）</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;">is</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> getApplicationContext</span><span style="color:#89DDFF;">().</span><span style="color:#F07178;">getAssets</span><span style="color:#89DDFF;">().</span><span style="color:#C792EA;">open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">images/abc.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">IOException</span><span style="color:#F07178;"> e</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        e</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 步骤4:替换资源</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 参数1：http请求里该图片的Content-Type,此处图片为image/png</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 参数2：编码类型</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 参数3：存放着替换资源的输入流（上面创建的那个）</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#FFCB6B;">WebResourceResponse</span><span style="color:#F07178;"> response </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> new </span><span style="color:#FFCB6B;">WebResourceResponse</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">is);</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> response</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shouldInterceptRequest</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> url</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#676E95;font-style:italic;">// API 21 以上用shouldInterceptRequest(WebView view, WebResourceRequest request)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">@TargetApi</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Build</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">VERSION_CODES</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">LOLLIPOP</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">public</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">WebResourceResponse</span><span style="color:#F07178;"> shouldInterceptRequest</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">WebView</span><span style="color:#F07178;"> view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">WebResourceRequest</span><span style="color:#F07178;"> request</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#676E95;font-style:italic;">// 步骤1:判断拦截资源的条件，即判断url里的图片资源的文件名</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#676E95;font-style:italic;">// 假设网页里该图片资源的地址为：http://abc.com/imgage/logo.gif</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#676E95;font-style:italic;">// 图片的资源文件名为:logo.gif</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">getUrl</span><span style="color:#89DDFF;">().</span><span style="color:#F07178;">toString</span><span style="color:#89DDFF;">().</span><span style="color:#F07178;">contains</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">logo.gif</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 步骤2:创建一个输入流</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#FFCB6B;">InputStream</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">is</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#676E95;font-style:italic;">// 步骤3:获得需要替换的资源(存放在assets文件夹里)</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#676E95;font-style:italic;">// a. 先在app/src/main下创建一个assets文件夹</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#676E95;font-style:italic;">// b. 在assets文件夹里再创建一个images文件夹</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#676E95;font-style:italic;">// c. 在images文件夹放上需要替换的资源（此处替换的是abc.png图片</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#89DDFF;">is</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> getApplicationContext</span><span style="color:#89DDFF;">().</span><span style="color:#F07178;">getAssets</span><span style="color:#89DDFF;">().</span><span style="color:#C792EA;">open</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">images/abc.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">IOException</span><span style="color:#F07178;"> e</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        e</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">printStackTrace</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 步骤4:替换资源</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 参数1：http请求里该图片的Content-Type,此处图片为image/png</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 参数2：编码类型</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#676E95;font-style:italic;">// 参数3：存放着替换资源的输入流（上面创建的那个）</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#FFCB6B;">WebResourceResponse</span><span style="color:#F07178;"> response </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> new </span><span style="color:#FFCB6B;">WebResourceResponse</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">is);</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> response</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shouldInterceptRequest</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">view</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> request</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p><strong>另：</strong></p><p>Android加载网页的选择有三种方案，分别是：</p><ul><li>使用Android系统自带的WebView</li><li>使用腾讯X5内核的WebView</li><li>使用基于chrome webkit的crosswalk WebView 方案对比及建议如下：</li></ul><p><img src="https://webpon-img.oss-cn-guangzhou.aliyuncs.com/imgwebp-165461930004440.webp" alt="img"></p>`,613),e=[o];function t(c,r,y,i,D,F){return a(),n("div",null,e)}const u=s(p,[["render",t]]);export{C as __pageData,u as default};
